"use strict";(self.webpackChunkcanvas_gamification_ui=self.webpackChunkcanvas_gamification_ui||[]).push([[81],{16081:(li,Me,j)=>{j.r(Me),j.d(Me,{Table:()=>Rr,createTable:()=>Or,default:()=>Rr});var Zt,jt,yt=j(71157),R=j(10647),I=j(94242),Er=j(74136),Et=j(90805),zr=j(99163);if("undefined"!=typeof WeakMap){var Te=new WeakMap;Zt=function(n){return Te.get(n)},jt=function(n,t){return Te.set(n,t),t}}else{var gt=[],zt=0;Zt=function(n){for(var t=0;t<gt.length;t+=2)if(gt[t]==n)return gt[t+1]},jt=function(n,t){return 10==zt&&(zt=0),gt[zt++]=n,gt[zt++]=t}}var ft=function(t,e,r,i){this.left=t,this.top=e,this.right=r,this.bottom=i},k=function(t,e,r,i){this.width=t,this.height=e,this.map=r,this.problems=i};function _r(n){if(n.colwidth)return n.colwidth.slice();for(var t=[],e=0;e<n.colspan;e++)t.push(0);return t}function _(n){var t=n.cached.tableNodeTypes;if(!t)for(var e in t=n.cached.tableNodeTypes={},n.nodes){var r=n.nodes[e],i=r.spec.tableRole;i&&(t[i]=r)}return t}k.prototype.findCell=function(t){for(var e=0;e<this.map.length;e++){var r=this.map[e];if(r==t){for(var i=e%this.width,o=e/this.width|0,a=i+1,s=o+1,f=1;a<this.width&&this.map[e+f]==r;f++)a++;for(var l=1;s<this.height&&this.map[e+this.width*l]==r;l++)s++;return new ft(i,o,a,s)}}throw new RangeError("No cell with offset "+t+" found")},k.prototype.colCount=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError("No cell with offset "+t+" found")},k.prototype.nextCell=function(t,e,r){var i=this.findCell(t),o=i.left,a=i.right,s=i.top,f=i.bottom;return"horiz"==e?(r<0?0==o:a==this.width)?null:this.map[s*this.width+(r<0?o-1:a)]:(r<0?0==s:f==this.height)?null:this.map[o+this.width*(r<0?s-1:f)]},k.prototype.rectBetween=function(t,e){var r=this.findCell(t),i=r.left,o=r.right,a=r.top,s=r.bottom,f=this.findCell(e),u=f.right,p=f.top,h=f.bottom;return new ft(Math.min(i,f.left),Math.min(a,p),Math.max(o,u),Math.max(s,h))},k.prototype.cellsInRect=function(t){for(var e=[],r={},i=t.top;i<t.bottom;i++)for(var o=t.left;o<t.right;o++){var a=i*this.width+o,s=this.map[a];r[s]||(r[s]=!0,(o!=t.left||!o||this.map[a-1]!=s)&&(i!=t.top||!i||this.map[a-this.width]!=s)&&e.push(s))}return e},k.prototype.positionAt=function(t,e,r){for(var i=0,o=0;;i++){var a=o+r.child(i).nodeSize;if(i==t){for(var s=e+t*this.width,f=(t+1)*this.width;s<f&&this.map[s]<o;)s++;return s==f?a-1:this.map[s]}o=a}},k.get=function(t){return Zt(t)||jt(t,function Fr(n){if("table"!=n.type.spec.tableRole)throw new RangeError("Not a table node: "+n.type.name);for(var t=function Br(n){for(var t=-1,e=!1,r=0;r<n.childCount;r++){var i=n.child(r),o=0;if(e)for(var a=0;a<r;a++)for(var s=n.child(a),f=0;f<s.childCount;f++){var l=s.child(f);a+l.attrs.rowspan>r&&(o+=l.attrs.colspan)}for(var u=0;u<i.childCount;u++){var p=i.child(u);o+=p.attrs.colspan,p.attrs.rowspan>1&&(e=!0)}-1==t?t=o:t!=o&&(t=Math.max(t,o))}return t}(n),e=n.childCount,r=[],i=0,o=null,a=[],s=0,f=t*e;s<f;s++)r[s]=0;for(var l=0,u=0;l<e;l++){var p=n.child(l);u++;for(var h=0;;h++){for(;i<r.length&&0!=r[i];)i++;if(h==p.childCount)break;for(var c=p.child(h),d=c.attrs,v=d.colspan,y=d.rowspan,C=d.colwidth,w=0;w<y;w++){if(w+l>=e){(o||(o=[])).push({type:"overlong_rowspan",pos:u,n:y-w});break}for(var z=i+w*t,x=0;x<v;x++){0==r[z+x]?r[z+x]=u:(o||(o=[])).push({type:"collision",row:l,pos:u,n:v-x});var A=C&&C[x];if(A){var P=(z+x)%t*2,J=a[P];null==J||J!=A&&1==a[P+1]?(a[P]=A,a[P+1]=1):J==A&&a[P+1]++}}}i+=v,u+=c.nodeSize}for(var Rt=(l+1)*t,st=0;i<Rt;)0==r[i++]&&st++;st&&(o||(o=[])).push({type:"missing",row:l,n:st}),u++}for(var mt=new k(t,e,r,o),xe=!1,Qt=0;!xe&&Qt<a.length;Qt+=2)null!=a[Qt]&&a[Qt+1]<e&&(xe=!0);return xe&&function Jr(n,t,e){n.problems||(n.problems=[]);for(var r=0,i={};r<n.map.length;r++){var o=n.map[r];if(!i[o]){i[o]=!0;for(var a=e.nodeAt(o),s=null,f=0;f<a.attrs.colspan;f++){var u=t[(r+f)%n.width*2];null!=u&&(!a.attrs.colwidth||a.attrs.colwidth[f]!=u)&&((s||(s=_r(a.attrs)))[f]=u)}s&&n.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:s})}}}(mt,a,n),mt}(t))};var $=new R.H$("selectingCells");function lt(n){for(var t=n.depth-1;t>0;t--)if("row"==n.node(t).type.spec.tableRole)return n.node(0).resolve(n.before(t+1));return null}function X(n){for(var t=n.selection.$head,e=t.depth;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return!0;return!1}function It(n){var t=n.selection;return t.$anchorCell?t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell:t.node&&"cell"==t.node.type.spec.tableRole?t.$anchor:lt(t.$head)||function Pr(n){for(var t=n.nodeAfter,e=n.pos;t;t=t.firstChild,e++){var r=t.type.spec.tableRole;if("cell"==r||"header_cell"==r)return n.doc.resolve(e)}for(var i=n.nodeBefore,o=n.pos;i;i=i.lastChild,o--){var a=i.type.spec.tableRole;if("cell"==a||"header_cell"==a)return n.doc.resolve(o-i.nodeSize)}}(t.$head)}function $t(n){return"row"==n.parent.type.spec.tableRole&&n.nodeAfter}function te(n,t){return n.depth==t.depth&&n.pos>=t.start(-1)&&n.pos<=t.end(-1)}function Ae(n,t,e){var r=n.start(-1),o=k.get(n.node(-1)).nextCell(n.pos-r,t,e);return null==o?null:n.node(0).resolve(r+o)}function F(n,t,e){var r={};for(var i in n)r[i]=n[i];return r[t]=e,r}function rt(n,t,e){void 0===e&&(e=1);var r=F(n,"colspan",n.colspan-e);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(t,e),r.colwidth.some(function(i){return i>0})||(r.colwidth=null)),r}function Re(n,t,e){void 0===e&&(e=1);var r=F(n,"colspan",n.colspan+e);if(r.colwidth){r.colwidth=r.colwidth.slice();for(var i=0;i<e;i++)r.colwidth.splice(t,0,0)}return r}var M=function(n){function t(e,r){void 0===r&&(r=e);var i=e.node(-1),o=k.get(i),a=e.start(-1),s=o.rectBetween(e.pos-a,r.pos-a),f=e.node(0),l=o.cellsInRect(s).filter(function(p){return p!=r.pos-a});l.unshift(r.pos-a);var u=l.map(function(p){var h=i.nodeAt(p),c=p+a+1;return new R.xm(f.resolve(c),f.resolve(c+h.content.size))});n.call(this,u[0].$from,u[0].$to,u),this.$anchorCell=e,this.$headCell=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.map=function(r,i){var o=r.resolve(i.map(this.$anchorCell.pos)),a=r.resolve(i.map(this.$headCell.pos));if($t(o)&&$t(a)&&te(o,a)){var s=this.$anchorCell.node(-1)!=o.node(-1);return s&&this.isRowSelection()?t.rowSelection(o,a):s&&this.isColSelection()?t.colSelection(o,a):new t(o,a)}return R.Bs.between(o,a)},t.prototype.content=function(){for(var r=this.$anchorCell.node(-1),i=k.get(r),o=this.$anchorCell.start(-1),a=i.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),s={},f=[],l=a.top;l<a.bottom;l++){for(var u=[],p=l*i.width+a.left,h=a.left;h<a.right;h++,p++){var c=i.map[p];if(!s[c]){s[c]=!0;var d=i.findCell(c),v=r.nodeAt(c),y=a.left-d.left,C=d.right-a.right;if(y>0||C>0){var w=v.attrs;y>0&&(w=rt(w,0,y)),C>0&&(w=rt(w,w.colspan-C,C)),v=d.left<a.left?v.type.createAndFill(w):v.type.create(w,v.content)}if(d.top<a.top||d.bottom>a.bottom){var z=F(v.attrs,"rowspan",Math.min(d.bottom,a.bottom)-Math.max(d.top,a.top));v=d.top<a.top?v.type.createAndFill(z):v.type.create(z,v.content)}u.push(v)}}f.push(r.child(l).copy(I.HY.from(u)))}var x=this.isColSelection()&&this.isRowSelection()?r:f;return new I.p2(I.HY.from(x),1,1)},t.prototype.replace=function(r,i){void 0===i&&(i=I.p2.empty);for(var o=r.steps.length,a=this.ranges,s=0;s<a.length;s++){var f=a[s],l=f.$from,u=f.$to,p=r.mapping.slice(o);r.replace(p.map(l.pos),p.map(u.pos),s?I.p2.empty:i)}var h=n.findFrom(r.doc.resolve(r.mapping.slice(o).map(this.to)),-1);h&&r.setSelection(h)},t.prototype.replaceWith=function(r,i){this.replace(r,new I.p2(I.HY.from(i),0,0))},t.prototype.forEachCell=function(r){for(var i=this.$anchorCell.node(-1),o=k.get(i),a=this.$anchorCell.start(-1),s=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-a,this.$headCell.pos-a)),f=0;f<s.length;f++)r(i.nodeAt(s[f]),a+s[f])},t.prototype.isColSelection=function(){var r=this.$anchorCell.index(-1),i=this.$headCell.index(-1);return!(Math.min(r,i)>0)&&Math.max(r+this.$anchorCell.nodeAfter.attrs.rowspan,i+this.$headCell.nodeAfter.attrs.rowspan)==this.$headCell.node(-1).childCount},t.colSelection=function(r,i){void 0===i&&(i=r);var o=k.get(r.node(-1)),a=r.start(-1),s=o.findCell(r.pos-a),f=o.findCell(i.pos-a),l=r.node(0);return s.top<=f.top?(s.top>0&&(r=l.resolve(a+o.map[s.left])),f.bottom<o.height&&(i=l.resolve(a+o.map[o.width*(o.height-1)+f.right-1]))):(f.top>0&&(i=l.resolve(a+o.map[f.left])),s.bottom<o.height&&(r=l.resolve(a+o.map[o.width*(o.height-1)+s.right-1]))),new t(r,i)},t.prototype.isRowSelection=function(){var r=k.get(this.$anchorCell.node(-1)),i=this.$anchorCell.start(-1),o=r.colCount(this.$anchorCell.pos-i),a=r.colCount(this.$headCell.pos-i);return!(Math.min(o,a)>0)&&Math.max(o+this.$anchorCell.nodeAfter.attrs.colspan,a+this.$headCell.nodeAfter.attrs.colspan)==r.width},t.prototype.eq=function(r){return r instanceof t&&r.$anchorCell.pos==this.$anchorCell.pos&&r.$headCell.pos==this.$headCell.pos},t.rowSelection=function(r,i){void 0===i&&(i=r);var o=k.get(r.node(-1)),a=r.start(-1),s=o.findCell(r.pos-a),f=o.findCell(i.pos-a),l=r.node(0);return s.left<=f.left?(s.left>0&&(r=l.resolve(a+o.map[s.top*o.width])),f.right<o.width&&(i=l.resolve(a+o.map[o.width*(f.top+1)-1]))):(f.left>0&&(i=l.resolve(a+o.map[f.top*o.width])),s.right<o.width&&(r=l.resolve(a+o.map[o.width*(s.top+1)-1]))),new t(r,i)},t.prototype.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},t.fromJSON=function(r,i){return new t(r.resolve(i.anchor),r.resolve(i.head))},t.create=function(r,i,o){return void 0===o&&(o=i),new t(r.resolve(i),r.resolve(o))},t.prototype.getBookmark=function(){return new Ft(this.$anchorCell.pos,this.$headCell.pos)},t}(R.Y1);M.prototype.visible=!1,R.Y1.jsonID("cell",M);var Ft=function(t,e){this.anchor=t,this.head=e};function Hr(n){if(!(n.selection instanceof M))return null;var t=[];return n.selection.forEachCell(function(e,r){t.push(Et.p.node(r,r+e.nodeSize,{class:"selectedCell"}))}),Et.EH.create(n.doc,t)}function ee(n,t){var e=n.createAndFill();return new zr.wx(e).replace(0,e.content.size,t).doc}function Ee(n,t,e,r,i,o,a,s){if(0==a||a==t.height)return!1;for(var f=!1,l=i;l<o;l++){var u=a*t.width+l,p=t.map[u];if(t.map[u-t.width]==p){f=!0;var h=e.nodeAt(p),c=t.findCell(p),d=c.top,v=c.left;n.setNodeMarkup(n.mapping.slice(s).map(p+r),null,F(h.attrs,"rowspan",a-d)),n.insert(n.mapping.slice(s).map(t.positionAt(a,v,e)),h.type.createAndFill(F(h.attrs,"rowspan",d+h.attrs.rowspan-a))),l+=h.attrs.colspan-1}}return f}function ze(n,t,e,r,i,o,a,s){if(0==a||a==t.width)return!1;for(var f=!1,l=i;l<o;l++){var u=l*t.width+a,p=t.map[u];if(t.map[u-1]==p){f=!0;var h=e.nodeAt(p),c=t.colCount(p),d=n.mapping.slice(s).map(p+r);n.setNodeMarkup(d,null,rt(h.attrs,a-c,h.attrs.colspan-(a-c))),n.insert(d+h.nodeSize,h.type.createAndFill(rt(h.attrs,0,a-c))),l+=h.attrs.rowspan-1}}return f}function Ie(n,t,e,r,i){var o=e?n.doc.nodeAt(e-1):n.doc,a=k.get(o),s=r.top,f=r.left,l=f+i.width,u=s+i.height,p=n.tr,h=0;function c(){o=e?p.doc.nodeAt(e-1):p.doc,a=k.get(o),h=p.mapping.maps.length}(function Gr(n,t,e,r,i,o,a){var l,u,f=_(n.doc.type.schema);if(i>t.width)for(var p=0,h=0;p<t.height;p++){var c=e.child(p);h+=c.nodeSize;var v,d=[];v=null==c.lastChild||c.lastChild.type==f.cell?l||(l=f.cell.createAndFill()):u||(u=f.header_cell.createAndFill());for(var y=t.width;y<i;y++)d.push(v);n.insert(n.mapping.slice(a).map(h-1+r),d)}if(o>t.height){for(var C=[],w=0,z=(t.height-1)*t.width;w<Math.max(t.width,i);w++){var x=!(w>=t.width)&&e.nodeAt(t.map[z+w]).type==f.header_cell;C.push(x?u||(u=f.header_cell.createAndFill()):l||(l=f.cell.createAndFill()))}for(var A=f.row.create(null,I.HY.from(C)),P=[],J=t.height;J<o;J++)P.push(A);n.insert(n.mapping.slice(a).map(r+e.nodeSize-2),P)}return!(!l&&!u)})(p,a,o,e,l,u,h)&&c(),Ee(p,a,o,e,f,l,s,h)&&c(),Ee(p,a,o,e,f,l,u,h)&&c(),ze(p,a,o,e,s,u,f,h)&&c(),ze(p,a,o,e,s,u,l,h)&&c();for(var d=s;d<u;d++){var v=a.positionAt(d,f,o),y=a.positionAt(d,l,o);p.replace(p.mapping.slice(h).map(v+e),p.mapping.slice(h).map(y+e),new I.p2(i.rows[d-s],0,0))}c(),p.setSelection(new M(p.doc.resolve(e+a.positionAt(s,f,o)),p.doc.resolve(e+a.positionAt(u-1,l-1,o)))),t(p)}Ft.prototype.map=function(t){return new Ft(t.map(this.anchor),t.map(this.head))},Ft.prototype.resolve=function(t){var e=t.resolve(this.anchor),r=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==r.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&r.index()<r.parent.childCount&&te(e,r)?new M(e,r):R.Y1.near(r,1)};var Qr=(0,Er.$)({ArrowLeft:Jt("horiz",-1),ArrowRight:Jt("horiz",1),ArrowUp:Jt("vert",-1),ArrowDown:Jt("vert",1),"Shift-ArrowLeft":_t("horiz",-1),"Shift-ArrowRight":_t("horiz",1),"Shift-ArrowUp":_t("vert",-1),"Shift-ArrowDown":_t("vert",1),Backspace:Dt,"Mod-Backspace":Dt,Delete:Dt,"Mod-Delete":Dt});function Bt(n,t,e){return!e.eq(n.selection)&&(t&&t(n.tr.setSelection(e).scrollIntoView()),!0)}function Jt(n,t){return function(e,r,i){var o=e.selection;if(o instanceof M)return Bt(e,r,R.Y1.near(o.$headCell,t));if("horiz"!=n&&!o.empty)return!1;var a=Fe(i,n,t);if(null==a)return!1;if("horiz"==n)return Bt(e,r,R.Y1.near(e.doc.resolve(o.head+t),t));var l,s=e.doc.resolve(a),f=Ae(s,n,t);return l=f?R.Y1.near(f,1):t<0?R.Y1.near(e.doc.resolve(s.before(-1)),-1):R.Y1.near(e.doc.resolve(s.after(-1)),1),Bt(e,r,l)}}function _t(n,t){return function(e,r,i){var o=e.selection;if(!(o instanceof M)){var a=Fe(i,n,t);if(null==a)return!1;o=new M(e.doc.resolve(a))}var s=Ae(o.$headCell,n,t);return!!s&&Bt(e,r,new M(o.$anchorCell,s))}}function Dt(n,t){var e=n.selection;if(!(e instanceof M))return!1;if(t){var r=n.tr,i=_(n.schema).cell.createAndFill().content;e.forEachCell(function(o,a){o.content.eq(i)||r.replace(r.mapping.map(a+1),r.mapping.map(a+o.nodeSize-1),new I.p2(i,0,0))}),r.docChanged&&t(r)}return!0}function Zr(n,t){var r=lt(n.state.doc.resolve(t));return!!r&&(n.dispatch(n.state.tr.setSelection(new M(r))),!0)}function jr(n,t,e){if(!X(n.state))return!1;var r=function Kr(n){if(!n.size)return null;for(var t=n.content,e=n.openStart,r=n.openEnd;1==t.childCount&&(e>0&&r>0||"table"==t.firstChild.type.spec.tableRole);)e--,r--,t=t.firstChild.content;var i=t.firstChild,o=i.type.spec.tableRole,a=i.type.schema,s=[];if("row"==o)for(var f=0;f<t.childCount;f++){var l=t.child(f).content,u=f?0:Math.max(0,e-1),p=f<t.childCount-1?0:Math.max(0,r-1);(u||p)&&(l=ee(_(a).row,new I.p2(l,u,p)).content),s.push(l)}else{if("cell"!=o&&"header_cell"!=o)return null;s.push(e||r?ee(_(a).row,new I.p2(t,e,r)).content:t)}return function Ur(n,t){for(var e=[],r=0;r<t.length;r++)for(var i=t[r],o=i.childCount-1;o>=0;o--)for(var a=i.child(o).attrs,s=a.rowspan,f=a.colspan,l=r;l<r+s;l++)e[l]=(e[l]||0)+f;for(var u=0,p=0;p<e.length;p++)u=Math.max(u,e[p]);for(var h=0;h<e.length;h++)if(h>=t.length&&t.push(I.HY.empty),e[h]<u){for(var c=_(n).cell.createAndFill(),d=[],v=e[h];v<u;v++)d.push(c);t[h]=t[h].append(I.HY.from(d))}return{height:t.length,width:u,rows:t}}(a,s)}(e),i=n.state.selection;if(i instanceof M){r||(r={width:1,height:1,rows:[I.HY.from(ee(_(n.state.schema).cell,e))]});var o=i.$anchorCell.node(-1),a=i.$anchorCell.start(-1),s=k.get(o).rectBetween(i.$anchorCell.pos-a,i.$headCell.pos-a);return r=function Xr(n,t,e){var r=n.width,i=n.height,o=n.rows;if(r!=t){for(var a=[],s=[],f=0;f<o.length;f++){for(var l=o[f],u=[],p=a[f]||0,h=0;p<t;h++){var c=l.child(h%l.childCount);p+c.attrs.colspan>t&&(c=c.type.create(rt(c.attrs,c.attrs.colspan,p+c.attrs.colspan-t),c.content)),u.push(c),p+=c.attrs.colspan;for(var d=1;d<c.attrs.rowspan;d++)a[f+d]=(a[f+d]||0)+c.attrs.colspan}s.push(I.HY.from(u))}o=s,r=t}if(i!=e){for(var v=[],y=0,C=0;y<e;y++,C++){for(var w=[],z=o[C%i],x=0;x<z.childCount;x++){var A=z.child(x);y+A.attrs.rowspan>e&&(A=A.type.create(F(A.attrs,"rowspan",Math.max(1,e-A.attrs.rowspan)),A.content)),w.push(A)}v.push(I.HY.from(w))}o=v,i=e}return{width:r,height:i,rows:o}}(r,s.right-s.left,s.bottom-s.top),Ie(n.state,n.dispatch,a,s,r),!0}if(r){var f=It(n.state),l=f.start(-1);return Ie(n.state,n.dispatch,l,k.get(f.node(-1)).findCell(f.pos-l),r),!0}return!1}function $r(n,t){if(!t.ctrlKey&&!t.metaKey){var r,e=Be(n,t.target);if(t.shiftKey&&n.state.selection instanceof M)i(n.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&e&&null!=(r=lt(n.state.selection.$anchor))&&re(n,t).pos!=r.pos)i(r,t),t.preventDefault();else if(!e)return;n.root.addEventListener("mouseup",o),n.root.addEventListener("dragstart",o),n.root.addEventListener("mousemove",a)}function i(s,f){var l=re(n,f),u=null==$.getState(n.state);if(!l||!te(s,l)){if(!u)return;l=s}var p=new M(s,l);if(u||!n.state.selection.eq(p)){var h=n.state.tr.setSelection(p);u&&h.setMeta($,s.pos),n.dispatch(h)}}function o(){n.root.removeEventListener("mouseup",o),n.root.removeEventListener("dragstart",o),n.root.removeEventListener("mousemove",a),null!=$.getState(n.state)&&n.dispatch(n.state.tr.setMeta($,-1))}function a(s){var l,f=$.getState(n.state);if(null!=f)l=n.state.doc.resolve(f);else if(Be(n,s.target)!=e&&!(l=re(n,t)))return o();l&&i(l,s)}}function Fe(n,t,e){if(!(n.state.selection instanceof R.Bs))return null;for(var i=n.state.selection.$head,o=i.depth-1;o>=0;o--){var a=i.node(o);if((e<0?i.index(o):i.indexAfter(o))!=(e<0?0:a.childCount))return null;if("cell"==a.type.spec.tableRole||"header_cell"==a.type.spec.tableRole){var f=i.before(o);return n.endOfTextblock("vert"==t?e>0?"down":"up":e>0?"right":"left")?f:null}}return null}function Be(n,t){for(;t&&t!=n.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t}function re(n,t){var e=n.posAtCoords({left:t.clientX,top:t.clientY});return e&&e?lt(n.state.doc.resolve(e.pos)):null}var tn=new R.H$("fix-tables");function Je(n,t,e,r){var i=n.childCount,o=t.childCount;t:for(var a=0,s=0;a<o;a++){for(var f=t.child(a),l=s,u=Math.min(i,a+3);l<u;l++)if(n.child(l)==f){s=l+1,e+=f.nodeSize;continue t}r(f,e),s<i&&n.child(s).sameMarkup(f)?Je(n.child(s),f,e+1,r):f.nodesBetween(0,f.content.size,r,e+1),e+=f.nodeSize}}function _e(n,t){var e,r=function(i,o){"table"==i.type.spec.tableRole&&(e=function en(n,t,e,r){var i=k.get(t);if(!i.problems)return r;r||(r=n.tr);for(var o=[],a=0;a<i.height;a++)o.push(0);for(var s=0;s<i.problems.length;s++){var f=i.problems[s];if("collision"==f.type){for(var l=t.nodeAt(f.pos),u=0;u<l.attrs.rowspan;u++)o[f.row+u]+=f.n;r.setNodeMarkup(r.mapping.map(e+1+f.pos),null,rt(l.attrs,l.attrs.colspan-f.n,f.n))}else if("missing"==f.type)o[f.row]+=f.n;else if("overlong_rowspan"==f.type){var p=t.nodeAt(f.pos);r.setNodeMarkup(r.mapping.map(e+1+f.pos),null,F(p.attrs,"rowspan",p.attrs.rowspan-f.n))}else if("colwidth mismatch"==f.type){var h=t.nodeAt(f.pos);r.setNodeMarkup(r.mapping.map(e+1+f.pos),null,F(h.attrs,"colwidth",f.colwidth))}}for(var c,d,v=0;v<o.length;v++)o[v]&&(null==c&&(c=v),d=v);for(var y=0,C=e+1;y<i.height;y++){var w=t.child(y),z=C+w.nodeSize,x=o[y];if(x>0){var A="cell";w.firstChild&&(A=w.firstChild.type.spec.tableRole);for(var P=[],J=0;J<x;J++)P.push(_(n.schema)[A].createAndFill());r.insert(r.mapping.map(0!=y&&c!=y-1||d!=y?z-1:C+1),P)}C=z}return r.setMeta(tn,{fixTables:!0})}(n,i,o,e))};return t?t.doc!=n.doc&&Je(t.doc,n.doc,0,r):n.doc.descendants(r),e}function G(n){var a,t=n.selection,e=It(n),r=e.node(-1),i=e.start(-1),o=k.get(r);return(a=t instanceof M?o.rectBetween(t.$anchorCell.pos-i,t.$headCell.pos-i):o.findCell(e.pos-i)).tableStart=i,a.map=o,a.table=r,a}function De(n,t,e){var r=t.map,i=t.tableStart,o=t.table,a=e>0?-1:0;(function Lr(n,t,e){for(var r=_(t.type.schema).header_cell,i=0;i<n.height;i++)if(t.nodeAt(n.map[e+i*n.width]).type!=r)return!1;return!0})(r,o,e+a)&&(a=0==e||e==r.width?null:0);for(var s=0;s<r.height;s++){var f=s*r.width+e;if(e>0&&e<r.width&&r.map[f-1]==r.map[f]){var l=r.map[f],u=o.nodeAt(l);n.setNodeMarkup(n.mapping.map(i+l),null,Re(u.attrs,e-r.colCount(l))),s+=u.attrs.rowspan-1}else{var p=null==a?_(o.type.schema).cell:o.nodeAt(r.map[f+a]).type,h=r.positionAt(s,e,o);n.insert(n.mapping.map(i+h),p.createAndFill())}}return n}function on(n,t,e){for(var r=t.map,i=t.table,o=t.tableStart,a=n.mapping.maps.length,s=0;s<r.height;){var f=s*r.width+e,l=r.map[f],u=i.nodeAt(l);if(e>0&&r.map[f-1]==l||e<r.width-1&&r.map[f+1]==l)n.setNodeMarkup(n.mapping.slice(a).map(o+l),null,rt(u.attrs,e-r.colCount(l)));else{var p=n.mapping.slice(a).map(o+l);n.delete(p,p+u.nodeSize)}s+=u.attrs.rowspan}}function Pe(n,t,e){for(var r=t.map,i=t.tableStart,o=t.table,a=i,s=0;s<e;s++)a+=o.child(s).nodeSize;var f=[],l=e>0?-1:0;(function sn(n,t,e){for(var r=_(t.type.schema).header_cell,i=0;i<n.width;i++)if(t.nodeAt(n.map[i+e*n.width]).type!=r)return!1;return!0})(r,o,e+l)&&(l=0==e||e==r.height?null:0);for(var u=0,p=r.width*e;u<r.width;u++,p++)if(e>0&&e<r.height&&r.map[p]==r.map[p-r.width]){var h=r.map[p],c=o.nodeAt(h).attrs;n.setNodeMarkup(i+h,null,F(c,"rowspan",c.rowspan+1)),u+=c.colspan-1}else{var d=null==l?_(o.type.schema).cell:o.nodeAt(r.map[p+l*r.width]).type;f.push(d.createAndFill())}return n.insert(a,_(o.type.schema).row.create(null,f)),n}function un(n,t,e){for(var r=t.map,i=t.table,o=t.tableStart,a=0,s=0;s<e;s++)a+=i.child(s).nodeSize;var f=a+i.child(e).nodeSize,l=n.mapping.maps.length;n.delete(a+o,f+o);for(var u=0,p=e*r.width;u<r.width;u++,p++){var h=r.map[p];if(e>0&&h==r.map[p-r.width]){var c=i.nodeAt(h).attrs;n.setNodeMarkup(n.mapping.slice(l).map(h+o),null,F(c,"rowspan",c.rowspan-1)),u+=c.colspan-1}else if(e<r.width&&h==r.map[p+r.width]){var d=i.nodeAt(h),v=d.type.create(F(d.attrs,"rowspan",d.attrs.rowspan-1),d.content),y=r.positionAt(e+1,u,i);n.insert(n.mapping.slice(l).map(o+y),v),u+=d.attrs.colspan-1}}}function We(n){var t=n.content;return 1==t.childCount&&t.firstChild.isTextblock&&0==t.firstChild.childCount}function Le(n,t){var e=n.selection;if(!(e instanceof M)||e.$anchorCell.pos==e.$headCell.pos)return!1;var r=G(n),i=r.map;if(function hn(n,t){for(var e=n.width,r=n.height,i=n.map,o=t.top*e+t.left,a=o,s=(t.bottom-1)*e+t.left,f=o+(t.right-t.left-1),l=t.top;l<t.bottom;l++){if(t.left>0&&i[a]==i[a-1]||t.right<e&&i[f]==i[f+1])return!0;a+=e,f+=e}for(var u=t.left;u<t.right;u++){if(t.top>0&&i[o]==i[o-e]||t.bottom<r&&i[s]==i[s+e])return!0;o++,s++}return!1}(i,r))return!1;if(t){for(var f,l,o=n.tr,a={},s=I.HY.empty,u=r.top;u<r.bottom;u++)for(var p=r.left;p<r.right;p++){var h=i.map[u*i.width+p],c=r.table.nodeAt(h);if(!a[h])if(a[h]=!0,null==f)f=h,l=c;else{We(c)||(s=s.append(c.content));var d=o.mapping.map(h+r.tableStart);o.delete(d,d+c.nodeSize)}}if(o.setNodeMarkup(f+r.tableStart,null,F(Re(l.attrs,l.attrs.colspan,r.right-r.left-l.attrs.colspan),"rowspan",r.bottom-r.top)),s.size){var v=f+1+l.content.size,y=We(l)?f+1:v;o.replaceWith(y+r.tableStart,v+r.tableStart,s)}o.setSelection(new M(o.doc.resolve(f+r.tableStart))),t(o)}return!0}function He(n,t){var e=_(n.schema);return function cn(n){return function(t,e){var i,o,r=t.selection;if(r instanceof M){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;i=r.$anchorCell.nodeAfter,o=r.$anchorCell.pos}else{if(i=function Dr(n){for(var t=n.depth;t>0;t--){var e=n.node(t).type.spec.tableRole;if("cell"===e||"header_cell"===e)return n.node(t)}return null}(r.$from),!i)return!1;o=lt(r.$from).pos}if(1==i.attrs.colspan&&1==i.attrs.rowspan)return!1;if(e){var a=i.attrs,s=[],f=a.colwidth;a.rowspan>1&&(a=F(a,"rowspan",1)),a.colspan>1&&(a=F(a,"colspan",1));for(var l=G(t),u=t.tr,p=0;p<l.right-l.left;p++)s.push(f?F(a,"colwidth",f&&f[p]?[f[p]]:null):a);for(var h,c=l.top;c<l.bottom;c++){var d=l.map.positionAt(c,l.left,l.table);c==l.top&&(d+=i.nodeSize);for(var v=l.left,y=0;v<l.right;v++,y++)v==l.left&&c==l.top||u.insert(h=u.mapping.map(d+l.tableStart,1),n({node:i,row:c,col:v}).createAndFill(s[y]))}u.setNodeMarkup(o,n({node:i,row:l.top,col:l.left}),s[0]),r instanceof M&&u.setSelection(new M(u.doc.resolve(r.$anchorCell.pos),h&&u.doc.resolve(h))),e(u)}return!0}}(function(r){return e[r.node.type.spec.tableRole]})(n,t)}function qe(n,t,e){for(var r=t.map.cellsInRect({left:0,top:0,right:"row"==n?t.map.width:1,bottom:"column"==n?t.map.height:1}),i=0;i<r.length;i++){var o=t.table.nodeAt(r[i]);if(o&&o.type!==e.header_cell)return!1}return!0}function ne(n,t){return(t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic?function vn(n){return function(t,e){if(!X(t))return!1;if(e){for(var r=_(t.schema),i=G(t),o=t.tr,a=i.map.cellsInRect("column"==n?new ft(i.left,0,i.right,i.map.height):"row"==n?new ft(0,i.top,i.map.width,i.bottom):i),s=a.map(function(u){return i.table.nodeAt(u)}),f=0;f<a.length;f++)s[f].type==r.header_cell&&o.setNodeMarkup(i.tableStart+a[f],r.cell,s[f].attrs);if(0==o.steps.length)for(var l=0;l<a.length;l++)o.setNodeMarkup(i.tableStart+a[l],r.header_cell,s[l].attrs);e(o)}return!0}}(n):function(e,r){if(!X(e))return!1;if(r){var i=_(e.schema),o=G(e),a=e.tr,s=qe("row",o,i),f=qe("column",o,i),u=("column"===n?s:"row"===n&&f)?1:0,p="column"==n?new ft(0,u,1,o.map.height):"row"==n?new ft(u,0,o.map.width,1):o,h="column"==n?f?i.cell:i.header_cell:"row"==n?s?i.cell:i.header_cell:i.cell;o.map.cellsInRect(p).forEach(function(c){var d=c+o.tableStart,v=a.doc.nodeAt(d);v&&a.setNodeMarkup(d,h,v.attrs)}),r(a)}return!0}}var mn=ne("row",{useDeprecatedLogic:!0}),yn=ne("column",{useDeprecatedLogic:!0}),gn=ne("cell",{useDeprecatedLogic:!0});function Ve(n){return function(t,e){if(!X(t))return!1;var r=function wn(n,t){if(t<0){var e=n.nodeBefore;if(e)return n.pos-e.nodeSize;for(var r=n.index(-1)-1,i=n.before();r>=0;r--){var o=n.node(-1).child(r);if(o.childCount)return i-1-o.lastChild.nodeSize;i-=o.nodeSize}}else{if(n.index()<n.parent.childCount-1)return n.pos+n.nodeAfter.nodeSize;for(var a=n.node(-1),s=n.indexAfter(-1),f=n.after();s<a.childCount;s++){var l=a.child(s);if(l.childCount)return f+1;f+=l.nodeSize}}}(It(t),n);if(null!=r){if(e){var i=t.doc.resolve(r);e(t.tr.setSelection(R.Bs.between(i,function Wr(n){return n.node(0).resolve(n.pos+n.nodeAfter.nodeSize)}(i))).scrollIntoView())}return!0}}}var ie=function(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),oe(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};function oe(n,t,e,r,i,o){for(var a=0,s=!0,f=t.firstChild,l=n.firstChild,u=0,p=0;u<l.childCount;u++)for(var h=l.child(u).attrs,c=h.colspan,d=h.colwidth,v=0;v<c;v++,p++){var y=i==p?o:d&&d[v],C=y?y+"px":"";a+=y||r,y||(s=!1),f?(f.style.width!=C&&(f.style.width=C),f=f.nextSibling):t.appendChild(document.createElement("col")).style.width=C}for(;f;){var w=f.nextSibling;f.parentNode.removeChild(f),f=w}s?(e.style.width=a+"px",e.style.minWidth=""):(e.style.width="",e.style.minWidth=a+"px")}ie.prototype.update=function(t){return t.type==this.node.type&&(this.node=t,oe(t,this.colgroup,this.table,this.cellMinWidth),!0)},ie.prototype.ignoreMutation=function(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))};var K=new R.H$("tableColumnResizing");function bn(n){void 0===n&&(n={});var t=n.handleWidth;void 0===t&&(t=5);var e=n.cellMinWidth;void 0===e&&(e=25);var r=n.View;void 0===r&&(r=ie);var i=n.lastColumnResizable;void 0===i&&(i=!0);var o=new R.Sy({key:K,state:{init:function(s,f){return this.spec.props.nodeViews[_(f.schema).table.name]=function(l,u){return new r(l,e,u)},new wt(-1,!1)},apply:function(s,f){return f.apply(s)}},props:{attributes:function(s){return K.getState(s).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function(s,f){!function Cn(n,t,e,r,i){var o=K.getState(n.state);if(!o.dragging){var a=function Tn(n){for(;n&&"TD"!=n.nodeName&&"TH"!=n.nodeName;)n=n.classList.contains("ProseMirror")?null:n.parentNode;return n}(t.target),s=-1;if(a){var f=a.getBoundingClientRect(),u=f.right;t.clientX-f.left<=e?s=Ye(n,t,"left"):u-t.clientX<=e&&(s=Ye(n,t,"right"))}if(s!=o.activeHandle){if(!i&&-1!==s){var p=n.state.doc.resolve(s),h=p.node(-1),c=k.get(h),d=p.start(-1);if(c.colCount(p.pos-d)+p.nodeAfter.attrs.colspan-1==c.width-1)return}Ue(n,s)}}}(s,f,t,0,i)},mouseleave:function(s){!function kn(n){var t=K.getState(n.state);t.activeHandle>-1&&!t.dragging&&Ue(n,-1)}(s)},mousedown:function(s,f){!function xn(n,t,e){var r=K.getState(n.state);if(-1==r.activeHandle||r.dragging)return!1;var i=n.state.doc.nodeAt(r.activeHandle),o=function Mn(n,t,e){var r=e.colspan,i=e.colwidth,o=i&&i[i.length-1];if(o)return o;var a=n.domAtPos(t),f=a.node.childNodes[a.offset].offsetWidth,l=r;if(i)for(var u=0;u<r;u++)i[u]&&(f-=i[u],l--);return f/l}(n,r.activeHandle,i.attrs);function a(f){window.removeEventListener("mouseup",a),window.removeEventListener("mousemove",s);var l=K.getState(n.state);l.dragging&&(function Nn(n,t,e){for(var r=n.state.doc.resolve(t),i=r.node(-1),o=k.get(i),a=r.start(-1),s=o.colCount(r.pos-a)+r.nodeAfter.attrs.colspan-1,f=n.state.tr,l=0;l<o.height;l++){var u=l*o.width+s;if(!l||o.map[u]!=o.map[u-o.width]){var p=o.map[u],c=i.nodeAt(p).attrs,d=1==c.colspan?0:s-o.colCount(p);if(!c.colwidth||c.colwidth[d]!=e){var v=c.colwidth?c.colwidth.slice():An(c.colspan);v[d]=e,f.setNodeMarkup(a+p,null,F(c,"colwidth",v))}}}f.docChanged&&n.dispatch(f)}(n,l.activeHandle,Ke(l.dragging,f,e)),n.dispatch(n.state.tr.setMeta(K,{setDragging:null})))}function s(f){if(!f.which)return a(f);var l=K.getState(n.state),u=Ke(l.dragging,f,e);!function On(n,t,e,r){for(var i=n.state.doc.resolve(t),o=i.node(-1),a=i.start(-1),s=k.get(o).colCount(i.pos-a)+i.nodeAfter.attrs.colspan-1,f=n.domAtPos(i.start(-1)).node;"TABLE"!=f.nodeName;)f=f.parentNode;oe(o,f.firstChild,f,r,s,e)}(n,l.activeHandle,u,e)}n.dispatch(n.state.tr.setMeta(K,{setDragging:{startX:t.clientX,startWidth:o}})),window.addEventListener("mouseup",a),window.addEventListener("mousemove",s),t.preventDefault()}(s,f,e)}},decorations:function(s){var f=K.getState(s);if(f.activeHandle>-1)return function Rn(n,t){for(var e=[],r=n.doc.resolve(t),i=r.node(-1),o=k.get(i),a=r.start(-1),s=o.colCount(r.pos-a)+r.nodeAfter.attrs.colspan,f=0;f<o.height;f++){var l=s+f*o.width-1;if(!(s!=o.width&&o.map[l]==o.map[l+1]||0!=f&&o.map[l-1]==o.map[l-1-o.width])){var u=o.map[l],p=a+u+i.nodeAt(u).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",e.push(Et.p.widget(p,h))}}return Et.EH.create(n.doc,e)}(s,f.activeHandle)},nodeViews:{}}});return o}var wt=function(t,e){this.activeHandle=t,this.dragging=e};function Ye(n,t,e){var r=n.posAtCoords({left:t.clientX,top:t.clientY});if(!r)return-1;var o=lt(n.state.doc.resolve(r.pos));if(!o)return-1;if("right"==e)return o.pos;var a=k.get(o.node(-1)),s=o.start(-1),f=a.map.indexOf(o.pos-s);return f%a.width==0?-1:s+a.map[f-1]}function Ke(n,t,e){return Math.max(e,n.startWidth+(t.clientX-n.startX))}function Ue(n,t){n.dispatch(n.state.tr.setMeta(K,{setHandle:t}))}function An(n){for(var t=[],e=0;e<n;e++)t.push(0);return t}function En(n){void 0===n&&(n={});var t=n.allowTableNodeSelection;return void 0===t&&(t=!1),new R.Sy({key:$,state:{init:function(){return null},apply:function(r,i){var o=r.getMeta($);if(null!=o)return-1==o?null:o;if(null==i||!r.docChanged)return i;var a=r.mapping.mapResult(i);return a.deleted?null:a.pos}},props:{decorations:Hr,handleDOMEvents:{mousedown:$r},createSelectionBetween:function(r){if(null!=$.getState(r.state))return r.state.selection},handleTripleClick:Zr,handleKeyDown:Qr,handlePaste:jr},appendTransaction:function(r,i,o){return function Yr(n,t,e){var o,a,r=(t||n).selection,i=(t||n).doc;if(r instanceof R.qv&&(a=r.node.type.spec.tableRole)){if("cell"==a||"header_cell"==a)o=M.create(i,r.from);else if("row"==a){var s=i.resolve(r.from+1);o=M.rowSelection(s,s)}else if(!e){var f=k.get(r.node),l=r.from+1;o=M.create(i,l+1,l+f.map[f.width*f.height-1])}}else r instanceof R.Bs&&function qr(n){var t=n.$from,e=n.$to;if(t.pos==e.pos||t.pos<t.pos-6)return!1;for(var r=t.pos,i=e.pos,o=t.depth;o>=0&&!(t.after(o+1)<t.end(o));o--,r++);for(var a=e.depth;a>=0&&!(e.before(a+1)>e.start(a));a--,i--);return r==i&&/row|table/.test(t.node(o).type.spec.tableRole)}(r)?o=R.Bs.create(i,r.from):r instanceof R.Bs&&function Vr(n){for(var r,i,t=n.$from,e=n.$to,o=t.depth;o>0;o--){var a=t.node(o);if("cell"===a.type.spec.tableRole||"header_cell"===a.type.spec.tableRole){r=a;break}}for(var s=e.depth;s>0;s--){var f=e.node(s);if("cell"===f.type.spec.tableRole||"header_cell"===f.type.spec.tableRole){i=f;break}}return r!==i&&0===e.parentOffset}(r)&&(o=R.Bs.create(i,r.$from.start(),r.$from.end()));return o&&(t||(t=n.tr)).setSelection(o),t}(o,_e(o,i),t)}})}function Xe(n,t,e){for(var r=0;;r++){if(r==n.childCount||r==t.childCount)return n.childCount==t.childCount?null:e;var i=n.child(r),o=t.child(r);if(i!=o){if(!i.sameMarkup(o))return e;if(i.isText&&i.text!=o.text){for(var a=0;i.text[a]==o.text[a];a++)e++;return e}if(i.content.size||o.content.size){var s=Xe(i.content,o.content,e+1);if(null!=s)return s}e+=i.nodeSize}else e+=i.nodeSize}}function Ge(n,t,e,r){for(var i=n.childCount,o=t.childCount;;){if(0==i||0==o)return i==o?null:{a:e,b:r};var a=n.child(--i),s=t.child(--o),f=a.nodeSize;if(a!=s){if(!a.sameMarkup(s))return{a:e,b:r};if(a.isText&&a.text!=s.text){for(var l=0,u=Math.min(a.text.length,s.text.length);l<u&&a.text[a.text.length-l-1]==s.text[s.text.length-l-1];)l++,e--,r--;return{a:e,b:r}}if(a.content.size||s.content.size){var p=Ge(a.content,s.content,e-1,r-1);if(p)return p}e-=f,r-=f}else e-=f,r-=f}}wt.prototype.apply=function(t){var e=this,r=t.getMeta(K);if(r&&null!=r.setHandle)return new wt(r.setHandle,null);if(r&&void 0!==r.setDragging)return new wt(e.activeHandle,r.setDragging);if(e.activeHandle>-1&&t.docChanged){var i=t.mapping.map(e.activeHandle,-1);$t(t.doc.resolve(i))||(i=null),e=new wt(i,e.dragging)}return e};var m=function(t,e){if(this.content=t,this.size=e||0,null==e)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize},Pt={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};m.prototype.nodesBetween=function(t,e,r,i,o){void 0===i&&(i=0);for(var a=0,s=0;s<e;a++){var f=this.content[a],l=s+f.nodeSize;if(l>t&&!1!==r(f,i+s,o,a)&&f.content.size){var u=s+1;f.nodesBetween(Math.max(0,t-u),Math.min(f.content.size,e-u),r,i+u)}s=l}},m.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)},m.prototype.textBetween=function(t,e,r,i){var o="",a=!0;return this.nodesBetween(t,e,function(s,f){s.isText?(o+=s.text.slice(Math.max(t,f)-f,e-f),a=!r):s.isLeaf&&i?(o+="function"==typeof i?i(s):i,a=!r):!a&&s.isBlock&&(o+=r,a=!0)},0),o},m.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,r=t.firstChild,i=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(r)&&(i[i.length-1]=e.withText(e.text+r.text),o=1);o<t.content.length;o++)i.push(t.content[o]);return new m(i,this.size+t.size)},m.prototype.cut=function(t,e){if(null==e&&(e=this.size),0==t&&e==this.size)return this;var r=[],i=0;if(e>t)for(var o=0,a=0;a<e;o++){var s=this.content[o],f=a+s.nodeSize;f>t&&((a<t||f>e)&&(s=s.isText?s.cut(Math.max(0,t-a),Math.min(s.text.length,e-a)):s.cut(Math.max(0,t-a-1),Math.min(s.content.size,e-a-1))),r.push(s),i+=s.nodeSize),a=f}return new m(r,i)},m.prototype.cutByIndex=function(t,e){return t==e?m.empty:0==t&&e==this.content.length?this:new m(this.content.slice(t,e))},m.prototype.replaceChild=function(t,e){var r=this.content[t];if(r==e)return this;var i=this.content.slice(),o=this.size+e.nodeSize-r.nodeSize;return i[t]=e,new m(i,o)},m.prototype.addToStart=function(t){return new m([t].concat(this.content),this.size+t.nodeSize)},m.prototype.addToEnd=function(t){return new m(this.content.concat(t),this.size+t.nodeSize)},m.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},Pt.firstChild.get=function(){return this.content.length?this.content[0]:null},Pt.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},Pt.childCount.get=function(){return this.content.length},m.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},m.prototype.maybeChild=function(t){return this.content[t]},m.prototype.forEach=function(t){for(var e=0,r=0;e<this.content.length;e++){var i=this.content[e];t(i,r,e),r+=i.nodeSize}},m.prototype.findDiffStart=function(t,e){return void 0===e&&(e=0),Xe(this,t,e)},m.prototype.findDiffEnd=function(t,e,r){return void 0===e&&(e=this.size),void 0===r&&(r=t.size),Ge(this,t,e,r)},m.prototype.findIndex=function(t,e){if(void 0===e&&(e=-1),0==t)return Wt(0,t);if(t==this.size)return Wt(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var r=0,i=0;;r++){var a=i+this.child(r).nodeSize;if(a>=t)return a==t||e>0?Wt(r+1,a):Wt(r,i);i=a}},m.prototype.toString=function(){return"<"+this.toStringInner()+">"},m.prototype.toStringInner=function(){return this.content.join(", ")},m.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null},m.fromJSON=function(t,e){if(!e)return m.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new m(e.map(t.nodeFromJSON))},m.fromArray=function(t){if(!t.length)return m.empty;for(var e,r=0,i=0;i<t.length;i++){var o=t[i];r+=o.nodeSize,i&&o.isText&&t[i-1].sameMarkup(o)?(e||(e=t.slice(0,i)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new m(e||t,r)},m.from=function(t){if(!t)return m.empty;if(t instanceof m)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new m([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(m.prototype,Pt);var ae={index:0,offset:0};function Wt(n,t){return ae.index=n,ae.offset=t,ae}function Lt(n,t){if(n===t)return!0;if(!n||"object"!=typeof n||!t||"object"!=typeof t)return!1;var e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!Lt(n[r],t[r]))return!1}else{for(var i in n)if(!(i in t)||!Lt(n[i],t[i]))return!1;for(var o in t)if(!(o in n))return!1}return!0}m.empty=new m([],0);var S=function(t,e){this.type=t,this.attrs=e};function Q(n){var t=Error.call(this,n);return t.__proto__=Q.prototype,t}S.prototype.addToSet=function(t){for(var e,r=!1,i=0;i<t.length;i++){var o=t[i];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,i));else{if(o.type.excludes(this.type))return t;!r&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),r=!0),e&&e.push(o)}}return e||(e=t.slice()),r||e.push(this),e},S.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},S.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},S.prototype.eq=function(t){return this==t||this.type==t.type&&Lt(this.attrs,t.attrs)},S.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},S.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var r=t.marks[e.type];if(!r)throw new RangeError("There is no mark type "+e.type+" in this schema");return r.create(e.attrs)},S.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].eq(e[r]))return!1;return!0},S.setFrom=function(t){if(!t||0==t.length)return S.none;if(t instanceof S)return[t];var e=t.slice();return e.sort(function(r,i){return r.type.rank-i.type.rank}),e},S.none=[],(Q.prototype=Object.create(Error.prototype)).constructor=Q,Q.prototype.name="ReplaceError";var g=function(t,e,r){this.content=t,this.openStart=e,this.openEnd=r},Qe={size:{configurable:!0}};function Ze(n,t,e){var r=n.findIndex(t),i=r.index,o=r.offset,a=n.maybeChild(i),s=n.findIndex(e),f=s.index;if(o==t||a.isText){if(s.offset!=e&&!n.child(f).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=f)throw new RangeError("Removing non-flat range");return n.replaceChild(i,a.copy(Ze(a.content,t-o-1,e-o-1)))}function je(n,t,e,r){var i=n.findIndex(t),o=i.index,a=i.offset,s=n.maybeChild(o);if(a==t||s.isText)return r&&!r.canReplace(o,o,e)?null:n.cut(0,t).append(e).append(n.cut(t));var f=je(s.content,t-a-1,e);return f&&n.replaceChild(o,s.copy(f))}function zn(n,t,e){if(e.openStart>n.depth)throw new Q("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new Q("Inconsistent open depths");return $e(n,t,e,0)}function $e(n,t,e,r){var i=n.index(r),o=n.node(r);if(i==t.index(r)&&r<n.depth-e.openStart){var a=$e(n,t,e,r+1);return o.copy(o.content.replaceChild(i,a))}if(e.content.size){if(e.openStart||e.openEnd||n.depth!=r||t.depth!=r){var l=function In(n,t){for(var e=t.depth-n.openStart,i=t.node(e).copy(n.content),o=e-1;o>=0;o--)i=t.node(o).copy(m.from(i));return{start:i.resolveNoCache(n.openStart+e),end:i.resolveNoCache(i.content.size-n.openEnd-e)}}(e,n);return it(o,er(n,l.start,l.end,t,r))}var s=n.parent,f=s.content;return it(s,f.cut(0,n.parentOffset).append(e.content).append(f.cut(t.parentOffset)))}return it(o,Ht(n,t,r))}function tr(n,t){if(!t.type.compatibleContent(n.type))throw new Q("Cannot join "+t.type.name+" onto "+n.type.name)}function se(n,t,e){var r=n.node(e);return tr(r,t.node(e)),r}function nt(n,t){var e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function St(n,t,e,r){var i=(t||n).node(e),o=0,a=t?t.index(e):i.childCount;n&&(o=n.index(e),n.depth>e?o++:n.textOffset&&(nt(n.nodeAfter,r),o++));for(var s=o;s<a;s++)nt(i.child(s),r);t&&t.depth==e&&t.textOffset&&nt(t.nodeBefore,r)}function it(n,t){if(!n.type.validContent(t))throw new Q("Invalid content for node "+n.type.name);return n.copy(t)}function er(n,t,e,r,i){var o=n.depth>i&&se(n,t,i+1),a=r.depth>i&&se(e,r,i+1),s=[];return St(null,n,i,s),o&&a&&t.index(i)==e.index(i)?(tr(o,a),nt(it(o,er(n,t,e,r,i+1)),s)):(o&&nt(it(o,Ht(n,t,i+1)),s),St(t,e,i,s),a&&nt(it(a,Ht(e,r,i+1)),s)),St(r,null,i,s),new m(s)}function Ht(n,t,e){var r=[];return St(null,n,e,r),n.depth>e&&nt(it(se(n,t,e+1),Ht(n,t,e+1)),r),St(t,null,e,r),new m(r)}Qe.size.get=function(){return this.content.size-this.openStart-this.openEnd},g.prototype.insertAt=function(t,e){var r=je(this.content,t+this.openStart,e,null);return r&&new g(r,this.openStart,this.openEnd)},g.prototype.removeBetween=function(t,e){return new g(Ze(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)},g.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},g.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},g.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},g.fromJSON=function(t,e){if(!e)return g.empty;var r=e.openStart||0,i=e.openEnd||0;if("number"!=typeof r||"number"!=typeof i)throw new RangeError("Invalid input for Slice.fromJSON");return new g(m.fromJSON(t,e.content),r,i)},g.maxOpen=function(t,e){void 0===e&&(e=!0);for(var r=0,i=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)r++;for(var a=t.lastChild;a&&!a.isLeaf&&(e||!a.type.spec.isolating);a=a.lastChild)i++;return new g(t,r,i)},Object.defineProperties(g.prototype,Qe),g.empty=new g(m.empty,0,0);var T=function(t,e,r){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=r},ut={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};T.prototype.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},ut.parent.get=function(){return this.node(this.depth)},ut.doc.get=function(){return this.node(0)},T.prototype.node=function(t){return this.path[3*this.resolveDepth(t)]},T.prototype.index=function(t){return this.path[3*this.resolveDepth(t)+1]},T.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},T.prototype.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},T.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},T.prototype.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},T.prototype.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},ut.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},ut.nodeAfter.get=function(){var n=this.parent,t=this.index(this.depth);if(t==n.childCount)return null;var e=this.pos-this.path[this.path.length-1],r=n.child(t);return e?n.child(t).cut(e):r},ut.nodeBefore.get=function(){var n=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(n).cut(0,t):0==n?null:this.parent.child(n-1)},T.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var r=this.path[3*e],i=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)i+=r.child(o).nodeSize;return i},T.prototype.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return S.none;if(this.textOffset)return t.child(e).marks;var r=t.maybeChild(e-1),i=t.maybeChild(e);if(!r){var o=r;r=i,i=o}for(var a=r.marks,s=0;s<a.length;s++)!1===a[s].type.spec.inclusive&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a},T.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var r=e.marks,i=t.parent.maybeChild(t.index()),o=0;o<r.length;o++)!1===r[o].type.spec.inclusive&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r},T.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},T.prototype.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!e||e(this.node(r))))return new rr(this,t,r)},T.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},T.prototype.max=function(t){return t.pos>this.pos?t:this},T.prototype.min=function(t){return t.pos<this.pos?t:this},T.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},T.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var r=[],i=0,o=e,a=t;;){var s=a.content.findIndex(o),f=s.index,l=s.offset,u=o-l;if(r.push(a,f,i+l),!u||(a=a.child(f)).isText)break;o=u-1,i+=l+1}return new T(e,r,o)},T.resolveCached=function(t,e){for(var r=0;r<fe.length;r++){var i=fe[r];if(i.pos==e&&i.doc==t)return i}var o=fe[le]=T.resolve(t,e);return le=(le+1)%Fn,o},Object.defineProperties(T.prototype,ut);var fe=[],le=0,Fn=12,rr=function(t,e,r){this.$from=t,this.$to=e,this.depth=r},pt={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};pt.start.get=function(){return this.$from.before(this.depth+1)},pt.end.get=function(){return this.$to.after(this.depth+1)},pt.parent.get=function(){return this.$from.node(this.depth)},pt.startIndex.get=function(){return this.$from.index(this.depth)},pt.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(rr.prototype,pt);var Bn=Object.create(null),b=function(t,e,r,i){this.type=t,this.attrs=e,this.content=r||m.empty,this.marks=i||S.none},V={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};V.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},V.childCount.get=function(){return this.content.childCount},b.prototype.child=function(t){return this.content.child(t)},b.prototype.maybeChild=function(t){return this.content.maybeChild(t)},b.prototype.forEach=function(t){this.content.forEach(t)},b.prototype.nodesBetween=function(t,e,r,i){void 0===i&&(i=0),this.content.nodesBetween(t,e,r,i,this)},b.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)},V.textContent.get=function(){return this.textBetween(0,this.content.size,"")},b.prototype.textBetween=function(t,e,r,i){return this.content.textBetween(t,e,r,i)},V.firstChild.get=function(){return this.content.firstChild},V.lastChild.get=function(){return this.content.lastChild},b.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},b.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},b.prototype.hasMarkup=function(t,e,r){return this.type==t&&Lt(this.attrs,e||t.defaultAttrs||Bn)&&S.sameSet(this.marks,r||S.none)},b.prototype.copy=function(t){return void 0===t&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)},b.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)},b.prototype.cut=function(t,e){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},b.prototype.slice=function(t,e,r){if(void 0===e&&(e=this.content.size),void 0===r&&(r=!1),t==e)return g.empty;var i=this.resolve(t),o=this.resolve(e),a=r?0:i.sharedDepth(e),s=i.start(a),l=i.node(a).content.cut(i.pos-s,o.pos-s);return new g(l,i.depth-a,o.depth-a)},b.prototype.replace=function(t,e,r){return zn(this.resolve(t),this.resolve(e),r)},b.prototype.nodeAt=function(t){for(var e=this;;){var r=e.content.findIndex(t),o=r.offset;if(!(e=e.maybeChild(r.index)))return null;if(o==t||e.isText)return e;t-=o+1}},b.prototype.childAfter=function(t){var e=this.content.findIndex(t),r=e.index,i=e.offset;return{node:this.content.maybeChild(r),index:r,offset:i}},b.prototype.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),r=e.index,i=e.offset;if(i<t)return{node:this.content.child(r),index:r,offset:i};var o=this.content.child(r-1);return{node:o,index:r-1,offset:i-o.nodeSize}},b.prototype.resolve=function(t){return T.resolveCached(this,t)},b.prototype.resolveNoCache=function(t){return T.resolve(this,t)},b.prototype.rangeHasMark=function(t,e,r){var i=!1;return e>t&&this.nodesBetween(t,e,function(o){return r.isInSet(o.marks)&&(i=!0),!i}),i},V.isBlock.get=function(){return this.type.isBlock},V.isTextblock.get=function(){return this.type.isTextblock},V.inlineContent.get=function(){return this.type.inlineContent},V.isInline.get=function(){return this.type.isInline},V.isText.get=function(){return this.type.isText},V.isLeaf.get=function(){return this.type.isLeaf},V.isAtom.get=function(){return this.type.isAtom},b.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),function Jn(n,t){for(var e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}(this.marks,t)},b.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},b.prototype.canReplace=function(t,e,r,i,o){void 0===r&&(r=m.empty),void 0===i&&(i=0),void 0===o&&(o=r.childCount);var a=this.contentMatchAt(t).matchFragment(r,i,o),s=a&&a.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var f=i;f<o;f++)if(!this.type.allowsMarks(r.child(f).marks))return!1;return!0},b.prototype.canReplaceWith=function(t,e,r,i){if(i&&!this.type.allowsMarks(i))return!1;var o=this.contentMatchAt(t).matchType(r),a=o&&o.matchFragment(this.content,e);return!!a&&a.validEnd},b.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},b.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=S.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!S.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(r){return r.type.name}));this.content.forEach(function(r){return r.check()})},b.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(r){return r.toJSON()})),t},b.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,r)}var i=m.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,i,r)},Object.defineProperties(b.prototype,V);var W=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},qt={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};W.parse=function(t,e){var r=new Vt(t,e);if(null==r.next)return W.empty;var i=ir(r);r.next&&r.err("Unexpected trailing text");var o=function qn(n){var t=Object.create(null);return function e(r){var i=[];r.forEach(function(f){n[f].forEach(function(l){var u=l.term,p=l.to;if(u){var h=i.indexOf(u),c=h>-1&&i[h+1];sr(n,p).forEach(function(d){c||i.push(u,c=[]),-1==c.indexOf(d)&&c.push(d)})}})});for(var o=t[r.join(",")]=new W(r.indexOf(n.length-1)>-1),a=0;a<i.length;a+=2){var s=i[a+1].sort(ar);o.next.push(i[a],t[s.join(",")]||e(s))}return o}(sr(n,0))}(function Hn(n){var t=[[]];return i(function o(a,s){if("choice"==a.type)return a.exprs.reduce(function(C,w){return C.concat(o(w,s))},[]);if("seq"==a.type)for(var f=0;;f++){var l=o(a.exprs[f],s);if(f==a.exprs.length-1)return l;i(l,s=e())}else{if("star"==a.type){var u=e();return r(s,u),i(o(a.expr,u),u),[r(u)]}if("plus"==a.type){var p=e();return i(o(a.expr,s),p),i(o(a.expr,p),p),[r(p)]}if("opt"==a.type)return[r(s)].concat(o(a.expr,s));if("range"==a.type){for(var h=s,c=0;c<a.min;c++){var d=e();i(o(a.expr,h),d),h=d}if(-1==a.max)i(o(a.expr,h),h);else for(var v=a.min;v<a.max;v++){var y=e();r(h,y),i(o(a.expr,h),y),h=y}return[r(h)]}if("name"==a.type)return[r(s,null,a.value)]}}(n,0),e()),t;function e(){return t.push([])-1}function r(a,s,f){var l={term:f,to:s};return t[a].push(l),l}function i(a,s){a.forEach(function(f){return f.to=s})}}(i));return function Vn(n,t){for(var e=0,r=[n];e<r.length;e++){for(var i=r[e],o=!i.validEnd,a=[],s=0;s<i.next.length;s+=2){var f=i.next[s],l=i.next[s+1];a.push(f.name),o&&!(f.isText||f.hasRequiredAttrs())&&(o=!1),-1==r.indexOf(l)&&r.push(l)}o&&t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(o,r),o},W.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null},W.prototype.matchFragment=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=t.childCount);for(var i=this,o=e;i&&o<r;o++)i=i.matchType(t.child(o).type);return i},qt.inlineContent.get=function(){var n=this.next[0];return!!n&&n.isInline},qt.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var t=this.next[n];if(!t.isText&&!t.hasRequiredAttrs())return t}},W.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var r=0;r<t.next.length;r+=2)if(this.next[e]==t.next[r])return!0;return!1},W.prototype.fillBefore=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=0);var i=[this];return function o(a,s){var f=a.matchFragment(t,r);if(f&&(!e||f.validEnd))return m.from(s.map(function(c){return c.createAndFill()}));for(var l=0;l<a.next.length;l+=2){var u=a.next[l],p=a.next[l+1];if(!u.isText&&!u.hasRequiredAttrs()&&-1==i.indexOf(p)){i.push(p);var h=o(p,s.concat(u));if(h)return h}}}(this,[])},W.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var r=this.computeWrapping(t);return this.wrapCache.push(t,r),r},W.prototype.computeWrapping=function(t){for(var e=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var i=r.shift(),o=i.match;if(o.matchType(t)){for(var a=[],s=i;s.type;s=s.via)a.push(s.type);return a.reverse()}for(var f=0;f<o.next.length;f+=2){var l=o.next[f];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in e)&&(!i.type||o.next[f+1].validEnd)&&(r.push({match:l.contentMatch,type:l,via:i}),e[l.name]=!0)}}},qt.edgeCount.get=function(){return this.next.length>>1},W.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}},W.prototype.toString=function(){var t=[];return function e(r){t.push(r);for(var i=1;i<r.next.length;i+=2)-1==t.indexOf(r.next[i])&&e(r.next[i])}(this),t.map(function(r,i){for(var o=i+(r.validEnd?"*":" ")+" ",a=0;a<r.next.length;a+=2)o+=(a?", ":"")+r.next[a].name+"->"+t.indexOf(r.next[a+1]);return o}).join("\n")},Object.defineProperties(W.prototype,qt),W.empty=new W(!0);var Vt=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},nr={next:{configurable:!0}};function ir(n){var t=[];do{t.push(_n(n))}while(n.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function _n(n){var t=[];do{t.push(Dn(n))}while(n.next&&")"!=n.next&&"|"!=n.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function Dn(n){for(var t=function Ln(n){if(n.eat("(")){var t=ir(n);return n.eat(")")||n.err("Missing closing paren"),t}if(!/\W/.test(n.next)){var e=function Wn(n,t){var e=n.nodeTypes,r=e[t];if(r)return[r];var i=[];for(var o in e){var a=e[o];a.groups.indexOf(t)>-1&&i.push(a)}return 0==i.length&&n.err("No node type or group '"+t+"' found"),i}(n,n.next).map(function(r){return null==n.inline?n.inline=r.isInline:n.inline!=r.isInline&&n.err("Mixing inline and block content"),{type:"name",value:r}});return n.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}n.err("Unexpected token '"+n.next+"'")}(n);;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else{if(!n.eat("{"))break;t=Pn(n,t)}return t}function or(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var t=Number(n.next);return n.pos++,t}function Pn(n,t){var e=or(n),r=e;return n.eat(",")&&(r="}"!=n.next?or(n):-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:r,expr:t}}function ar(n,t){return t-n}function sr(n,t){var e=[];return function r(i){var o=n[i];if(1==o.length&&!o[0].term)return r(o[0].to);e.push(i);for(var a=0;a<o.length;a++){var s=o[a],l=s.to;!s.term&&-1==e.indexOf(l)&&r(l)}}(t),e.sort(ar)}function fr(n){var t=Object.create(null);for(var e in n){var r=n[e];if(!r.hasDefault)return null;t[e]=r.default}return t}function lr(n,t){var e=Object.create(null);for(var r in n){var i=t&&t[r];if(void 0===i){var o=n[r];if(!o.hasDefault)throw new RangeError("No value supplied for attribute "+r);i=o.default}e[r]=i}return e}function ur(n){var t=Object.create(null);if(n)for(var e in n)t[e]=new pr(n[e]);return t}nr.next.get=function(){return this.tokens[this.pos]},Vt.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)},Vt.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},Object.defineProperties(Vt.prototype,nr);var Y=function(t,e,r){this.name=t,this.schema=e,this.spec=r,this.groups=r.group?r.group.split(" "):[],this.attrs=ur(r.attrs),this.defaultAttrs=fr(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(r.inline||"text"==t),this.isText="text"==t},bt={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};bt.isInline.get=function(){return!this.isBlock},bt.isTextblock.get=function(){return this.isBlock&&this.inlineContent},bt.isLeaf.get=function(){return this.contentMatch==W.empty},bt.isAtom.get=function(){return this.isLeaf||this.spec.atom},Y.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},Y.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},Y.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:lr(this.attrs,t)},Y.prototype.create=function(t,e,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new b(this,this.computeAttrs(t),m.from(e),S.setFrom(r))},Y.prototype.createChecked=function(t,e,r){if(e=m.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new b(this,this.computeAttrs(t),e,S.setFrom(r))},Y.prototype.createAndFill=function(t,e,r){if(t=this.computeAttrs(t),(e=m.from(e)).size){var i=this.contentMatch.fillBefore(e);if(!i)return null;e=i.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(m.empty,!0);return o?new b(this,t,e.append(o),S.setFrom(r)):null},Y.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var r=0;r<t.childCount;r++)if(!this.allowsMarks(t.child(r).marks))return!1;return!0},Y.prototype.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},Y.prototype.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},Y.prototype.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,r=0;r<t.length;r++)this.allowsMarkType(t[r].type)?e&&e.push(t[r]):e||(e=t.slice(0,r));return e?e.length?e:S.empty:t},Y.compile=function(t,e){var r=Object.create(null);t.forEach(function(a,s){return r[a]=new Y(a,e,s)});var i=e.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r},Object.defineProperties(Y.prototype,bt);var pr=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},hr={isRequired:{configurable:!0}};hr.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(pr.prototype,hr);var ot=function(t,e,r,i){this.name=t,this.schema=r,this.spec=i,this.attrs=ur(i.attrs),this.rank=e,this.excluded=null;var o=fr(this.attrs);this.instance=o&&new S(this,o)};ot.prototype.create=function(t){return!t&&this.instance?this.instance:new S(this,lr(this.attrs,t))},ot.compile=function(t,e){var r=Object.create(null),i=0;return t.forEach(function(o,a){return r[o]=new ot(o,i++,e,a)}),r},ot.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},ot.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},ot.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var ue={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Yn={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},cr={ol:!0,ul:!0};function dr(n){return(n?1:0)|("full"===n?2:0)}var Z=function(t,e,r,i,o,a,s){this.type=t,this.attrs=e,this.solid=o,this.match=a||(4&s?null:t.contentMatch),this.options=s,this.content=[],this.marks=r,this.activeMarks=S.none,this.pendingMarks=i,this.stashMarks=[]};Z.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(m.from(t));if(!e){var i,r=this.type.contentMatch;return(i=r.findWrapping(t.type))?(this.match=r,i):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},Z.prototype.finish=function(t){if(!(1&this.options)){var r,e=this.content[this.content.length-1];e&&e.isText&&(r=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-r[0].length)))}var i=m.from(this.content);return!t&&this.match&&(i=i.append(this.match.fillBefore(m.empty,!0))),this.type?this.type.create(this.attrs,i,this.marks):i},Z.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]},Z.prototype.applyPending=function(t){for(var e=0,r=this.pendingMarks;e<r.length;e++){var i=r[e];(this.type?this.type.allowsMarkType(i.type):Xn(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}},Z.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!ue.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var N=function(t,e,r){this.parser=t,this.options=e,this.isOpen=r;var o,i=e.topNode,a=dr(e.preserveWhitespace)|(r?4:0);o=i?new Z(i.type,i.attrs,S.none,S.none,!0,e.topMatch||i.type.contentMatch,a):new Z(r?null:t.schema.topNodeType,null,S.none,S.none,!0,null,a),this.nodes=[o],this.open=0,this.find=e.findPositions,this.needsBlock=!1},ce={top:{configurable:!0},currentPos:{configurable:!0}};function Xn(n,t){var e=t.schema.nodes,r=function(a){var s=e[a];if(s.allowsMarkType(n)){var f=[],l=function(u){f.push(u);for(var p=0;p<u.edgeCount;p++){var h=u.edge(p),d=h.next;if(h.type==t||f.indexOf(d)<0&&l(d))return!0}};if(l(s.contentMatch))return{v:!0}}};for(var i in e){var o=r(i);if(o)return o.v}}ce.top.get=function(){return this.nodes[this.open]},N.prototype.addDOM=function(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){var e=t.getAttribute("style"),r=e?this.readStyles(function Un(n){for(var e,t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];e=t.exec(n);)r.push(e[1],e[2].trim());return r}(e)):null,i=this.top;if(null!=r)for(var o=0;o<r.length;o++)this.addPendingMark(r[o]);if(this.addElement(t),null!=r)for(var a=0;a<r.length;a++)this.removePendingMark(r[a],i)}},N.prototype.addTextNode=function(t){var e=t.nodeValue,r=this.top;if(2&r.options||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(1&r.options)e=2&r.options?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var i=r.content[r.content.length-1],o=t.previousSibling;(!i||o&&"BR"==o.nodeName||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)},N.prototype.addElement=function(t,e){var i,r=t.nodeName.toLowerCase();cr.hasOwnProperty(r)&&this.parser.normalizeLists&&function Kn(n){for(var t=n.firstChild,e=null;t;t=t.nextSibling){var r=1==t.nodeType?t.nodeName.toLowerCase():null;r&&cr.hasOwnProperty(r)&&e?(e.appendChild(t),t=e):"li"==r?e=t:r&&(e=null)}}(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(o?o.ignore:Yn.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var a,s=this.top,f=this.needsBlock;if(ue.hasOwnProperty(r))a=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),a&&this.sync(s),this.needsBlock=f}else this.addElementByRule(t,o,!1===o.consuming?i:null)},N.prototype.leafFallback=function(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))},N.prototype.ignoreFallback=function(t){"BR"==t.nodeName&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))},N.prototype.readStyles=function(t){var e=S.none;t:for(var r=0;r<t.length;r+=2)for(var i=null;;){var o=this.parser.matchStyle(t[r],t[r+1],this,i);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),!1!==o.consuming)break;i=o}return e},N.prototype.addElementByRule=function(t,e,r){var o,a,f,i=this;e.node?(a=this.parser.schema.nodes[e.node]).isLeaf?this.insertNode(a.create(e.attrs))||this.leafFallback(t):o=this.enter(a,e.attrs,e.preserveWhitespace):(f=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(f));var l=this.top;if(a&&a.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(p){return i.insertNode(p)});else{var u=e.contentElement;"string"==typeof u?u=t.querySelector(u):"function"==typeof u&&(u=u(t)),u||(u=t),this.findAround(t,u,!0),this.addAll(u,o)}o&&(this.sync(l),this.open--),f&&this.removePendingMark(f,l)},N.prototype.addAll=function(t,e,r,i){for(var o=r||0,a=r?t.childNodes[r]:t.firstChild,s=null==i?null:t.childNodes[i];a!=s;a=a.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(a),e&&ue.hasOwnProperty(a.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)},N.prototype.findPlace=function(t){for(var e,r,i=this.open;i>=0;i--){var o=this.nodes[i],a=o.findWrapping(t);if(a&&(!e||e.length>a.length)&&(e=a,r=o,!a.length)||o.solid)break}if(!e)return!1;this.sync(r);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0},N.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var r=this.top;r.applyPending(t.type),r.match&&(r.match=r.match.matchType(t.type));for(var i=r.activeMarks,o=0;o<t.marks.length;o++)(!r.type||r.type.allowsMarkType(t.marks[o].type))&&(i=t.marks[o].addToSet(i));return r.content.push(t.mark(i)),!0}return!1},N.prototype.enter=function(t,e,r){var i=this.findPlace(t.create(e));return i&&this.enterInner(t,e,!0,r),i},N.prototype.enterInner=function(t,e,r,i){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var a=null==i?-5&o.options:dr(i);4&o.options&&0==o.content.length&&(a|=4),this.nodes.push(new Z(t,e,o.activeMarks,o.pendingMarks,r,null,a)),this.open++},N.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},N.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},N.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t)return void(this.open=e)},ce.currentPos.get=function(){this.closeExtra();for(var n=0,t=this.open;t>=0;t--){for(var e=this.nodes[t].content,r=e.length-1;r>=0;r--)n+=e[r].nodeSize;t&&n++}return n},N.prototype.findAtPoint=function(t,e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==e&&(this.find[r].pos=this.currentPos)},N.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},N.prototype.findAround=function(t,e,r){if(t!=e&&this.find)for(var i=0;i<this.find.length;i++)null==this.find[i].pos&&1==t.nodeType&&t.contains(this.find[i].node)&&e.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)},N.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},N.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var r=t.split("/"),i=this.options.context,o=!(this.isOpen||i&&i.parent.type!=this.nodes[0].type),a=(o?0:1)-(i?i.depth+1:0),s=function(f,l){for(;f>=0;f--){var u=r[f];if(""==u){if(f==r.length-1||0==f)continue;for(;l>=a;l--)if(s(f-1,l))return!0;return!1}var p=l>0||0==l&&o?e.nodes[l].type:i&&l>=a?i.node(l-a).type:null;if(!p||p.name!=u&&-1==p.groups.indexOf(u))return!1;l--}return!0};return s(r.length-1,this.open)},N.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var i in this.parser.schema.nodes){var o=this.parser.schema.nodes[i];if(o.isTextblock&&o.defaultAttrs)return o}},N.prototype.addPendingMark=function(t){var e=function Gn(n,t){for(var e=0;e<t.length;e++)if(n.eq(t[e]))return t[e]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)},N.prototype.removePendingMark=function(t,e){for(var r=this.open;r>=0;r--){var i=this.nodes[r];if(i.pendingMarks.lastIndexOf(t)>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);var a=i.popFromStashMark(t);a&&i.type&&i.type.allowsMarkType(a.type)&&(i.activeMarks=a.addToSet(i.activeMarks))}if(i==e)break}},Object.defineProperties(N.prototype,ce);var mr=Math.pow(2,16);function Qn(n,t){return n+t*mr}function yr(n){return 65535&n}var de=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},B=function(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};B.prototype.recover=function(t){var e=0,r=yr(t);if(!this.inverted)for(var i=0;i<r;i++)e+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*r]+e+function Zn(n){return(n-(65535&n))/mr}(t)},B.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},B.prototype.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},B.prototype._map=function(t,e,r){for(var i=0,o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?i:0);if(f>t)break;var l=this.ranges[s+o],u=this.ranges[s+a],p=f+l;if(t<=p){var c=f+i+((l?t==f?-1:t==p?1:e:e)<0?0:u);if(r)return c;var d=t==(e<0?f:p)?null:Qn(s/3,t-f);return new de(c,e<0?t!=f:t!=p,d)}i+=u-l}return r?t+i:new de(t+i)},B.prototype.touches=function(t,e){for(var r=0,i=yr(e),o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?r:0);if(f>t)break;var l=this.ranges[s+o];if(t<=f+l&&s==3*i)return!0;r+=this.ranges[s+a]-l}return!1},B.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,i=0,o=0;i<this.ranges.length;i+=3){var a=this.ranges[i],s=a-(this.inverted?o:0),f=a+(this.inverted?0:o),l=this.ranges[i+e],u=this.ranges[i+r];t(s,s+l,f,f+u),o+=u-l}},B.prototype.invert=function(){return new B(this.ranges,!this.inverted)},B.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},B.offset=function(t){return 0==t?B.empty:new B(t<0?[0,-t,0]:[0,0,t])},B.empty=new B([]);var L=function(t,e,r,i){this.maps=t||[],this.from=r||0,this.to=null==i?this.maps.length:i,this.mirror=e};function ht(n){var t=Error.call(this,n);return t.__proto__=ht.prototype,t}L.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new L(this.maps,this.mirror,t,e)},L.prototype.copy=function(){return new L(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},L.prototype.appendMap=function(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},L.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var i=t.getMirror(e);this.appendMap(t.maps[e],null!=i&&i<e?r+i:null)}},L.prototype.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},L.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},L.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var i=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=i&&i>e?r-i-1:null)}},L.prototype.invert=function(){var t=new L;return t.appendMappingInverted(this),t},L.prototype.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},L.prototype.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},L.prototype._map=function(t,e,r){for(var i=!1,o=this.from;o<this.to;o++){var s=this.maps[o].mapResult(t,e);if(null!=s.recover){var f=this.getMirror(o);if(null!=f&&f>o&&f<this.to){o=f,t=this.maps[f].recover(s.recover);continue}}s.deleted&&(i=!0),t=s.pos}return r?t:new de(t,i)},(ht.prototype=Object.create(Error.prototype)).constructor=ht,ht.prototype.name="TransformError";var E=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new L},ve={before:{configurable:!0},docChanged:{configurable:!0}};function Yt(){throw new Error("Override me")}ve.before.get=function(){return this.docs.length?this.docs[0]:this.doc},E.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new ht(e.failed);return this},E.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},ve.docChanged.get=function(){return this.steps.length>0},E.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(E.prototype,ve);var me=Object.create(null),D=function(){};D.prototype.apply=function(t){return Yt()},D.prototype.getMap=function(){return B.empty},D.prototype.invert=function(t){return Yt()},D.prototype.map=function(t){return Yt()},D.prototype.merge=function(t){return null},D.prototype.toJSON=function(){return Yt()},D.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=me[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},D.jsonID=function(t,e){if(t in me)throw new RangeError("Duplicate use of step JSON ID "+t);return me[t]=e,e.prototype.jsonID=t,e};var H=function(t,e){this.doc=t,this.failed=e};H.ok=function(t){return new H(t,null)},H.fail=function(t){return new H(null,t)},H.fromReplace=function(t,e,r,i){try{return H.ok(t.replace(e,r,i))}catch(o){if(o instanceof Q)return H.fail(o.message);throw o}};var tt=function(n){function t(e,r,i,o){n.call(this),this.from=e,this.to=r,this.slice=i,this.structure=!!o}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){return this.structure&&ye(r,this.from,this.to)?H.fail("Structure replace would overwrite content"):H.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new B([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted?null:new t(i.pos,Math.max(i.pos,o.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size!=r.from||this.slice.openEnd||r.slice.openStart){if(r.to!=this.from||this.slice.openStart||r.slice.openEnd)return null;var o=this.slice.size+r.slice.size==0?g.empty:new g(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}var i=this.slice.size+r.slice.size==0?g.empty:new g(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),i,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if("number"!=typeof i.from||"number"!=typeof i.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(i.from,i.to,g.fromJSON(r,i.slice),!!i.structure)},t}(D);D.jsonID("replace",tt);var at=function(n){function t(e,r,i,o,a,s,f){n.call(this),this.from=e,this.to=r,this.gapFrom=i,this.gapTo=o,this.slice=a,this.insert=s,this.structure=!!f}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){if(this.structure&&(ye(r,this.from,this.gapFrom)||ye(r,this.gapTo,this.to)))return H.fail("Structure gap-replace would overwrite content");var i=r.slice(this.gapFrom,this.gapTo);if(i.openStart||i.openEnd)return H.fail("Gap is not a flat range");var o=this.slice.insertAt(this.insert,i.content);return o?H.fromReplace(r,this.from,this.to,o):H.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new B([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var i=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+i,this.from+this.insert,this.from+this.insert+i,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1),a=r.map(this.gapFrom,-1),s=r.map(this.gapTo,1);return i.deleted&&o.deleted||a<i.pos||s>o.pos?null:new t(i.pos,o.pos,a,s,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if("number"!=typeof i.from||"number"!=typeof i.to||"number"!=typeof i.gapFrom||"number"!=typeof i.gapTo||"number"!=typeof i.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(i.from,i.to,i.gapFrom,i.gapTo,g.fromJSON(r,i.slice),i.insert,!!i.structure)},t}(D);function ye(n,t,e){for(var r=n.resolve(t),i=e-t,o=r.depth;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0)for(var a=r.node(o).maybeChild(r.indexAfter(o));i>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,i--}return!1}function ge(n,t,e){for(var r=[],i=0;i<n.childCount;i++){var o=n.child(i);o.content.size&&(o=o.copy(ge(o.content,t,o))),o.isInline&&(o=t(o,e,i)),r.push(o)}return m.fromArray(r)}D.jsonID("replaceAround",at),E.prototype.lift=function(n,t){for(var e=n.$from,r=n.$to,i=n.depth,o=e.before(i+1),a=r.after(i+1),s=o,f=a,l=m.empty,u=0,p=i,h=!1;p>t;p--)h||e.index(p)>0?(h=!0,l=m.from(e.node(p).copy(l)),u++):s--;for(var c=m.empty,d=0,v=i,y=!1;v>t;v--)y||r.after(v+1)<r.end(v)?(y=!0,c=m.from(r.node(v).copy(c)),d++):f++;return this.step(new at(s,f,o,a,new g(l.append(c),u,d),l.size-u,!0))},E.prototype.wrap=function(n,t){for(var e=m.empty,r=t.length-1;r>=0;r--)e=m.from(t[r].type.create(t[r].attrs,e));var i=n.start,o=n.end;return this.step(new at(i,o,i,o,new g(e,0,0),t.length,!0))},E.prototype.setBlockType=function(n,t,e,r){var i=this;if(void 0===t&&(t=n),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var o=this.steps.length;return this.doc.nodesBetween(n,t,function(a,s){if(a.isTextblock&&!a.hasMarkup(e,r)&&function jn(n,t,e){var r=n.resolve(t),i=r.index();return r.parent.canReplaceWith(i,i+1,e)}(i.doc,i.mapping.slice(o).map(s),e)){i.clearIncompatible(i.mapping.slice(o).map(s,1),e);var f=i.mapping.slice(o),l=f.map(s,1),u=f.map(s+a.nodeSize,1);return i.step(new at(l,u,l+1,u-1,new g(m.from(e.create(r,null,a.marks)),0,0),1,!0)),!1}}),this},E.prototype.setNodeMarkup=function(n,t,e,r){var i=this.doc.nodeAt(n);if(!i)throw new RangeError("No node at given position");t||(t=i.type);var o=t.create(e,null,r||i.marks);if(i.isLeaf)return this.replaceWith(n,n+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new at(n,n+i.nodeSize,n+1,n+i.nodeSize-1,new g(m.from(o),0,0),1,!0))},E.prototype.split=function(n,t,e){void 0===t&&(t=1);for(var r=this.doc.resolve(n),i=m.empty,o=m.empty,a=r.depth,s=r.depth-t,f=t-1;a>s;a--,f--){i=m.from(r.node(a).copy(i));var l=e&&e[f];o=m.from(l?l.type.create(l.attrs,o):r.node(a).copy(o))}return this.step(new tt(n,n,new g(i.append(o),t,t),!0))},E.prototype.join=function(n,t){void 0===t&&(t=1);var e=new tt(n-t,n+t,g.empty,!0);return this.step(e)};var we=function(n){function t(e,r,i){n.call(this),this.from=e,this.to=r,this.mark=i}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),a=r.resolve(this.from),s=a.node(a.sharedDepth(this.to)),f=new g(ge(o.content,function(l,u){return l.isAtom&&u.type.allowsMarkType(i.mark.type)?l.mark(i.mark.addToSet(l.marks)):l},s),o.openStart,o.openEnd);return H.fromReplace(r,this.from,this.to,f)},t.prototype.invert=function(){return new kt(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if("number"!=typeof i.from||"number"!=typeof i.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}(D);D.jsonID("addMark",we);var kt=function(n){function t(e,r,i){n.call(this),this.from=e,this.to=r,this.mark=i}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),a=new g(ge(o.content,function(s){return s.mark(i.mark.removeFromSet(s.marks))}),o.openStart,o.openEnd);return H.fromReplace(r,this.from,this.to,a)},t.prototype.invert=function(){return new we(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if("number"!=typeof i.from||"number"!=typeof i.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}(D);function gr(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}D.jsonID("removeMark",kt),E.prototype.addMark=function(n,t,e){var r=this,i=[],o=[],a=null,s=null;return this.doc.nodesBetween(n,t,function(f,l,u){if(f.isInline){var p=f.marks;if(!e.isInSet(p)&&u.type.allowsMarkType(e.type)){for(var h=Math.max(l,n),c=Math.min(l+f.nodeSize,t),d=e.addToSet(p),v=0;v<p.length;v++)p[v].isInSet(d)||(a&&a.to==h&&a.mark.eq(p[v])?a.to=c:i.push(a=new kt(h,c,p[v])));s&&s.to==h?s.to=c:o.push(s=new we(h,c,e))}}}),i.forEach(function(f){return r.step(f)}),o.forEach(function(f){return r.step(f)}),this},E.prototype.removeMark=function(n,t,e){var r=this;void 0===e&&(e=null);var i=[],o=0;return this.doc.nodesBetween(n,t,function(a,s){if(a.isInline){o++;var f=null;if(e instanceof ot)for(var u,l=a.marks;u=e.isInSet(l);)(f||(f=[])).push(u),l=u.removeFromSet(l);else e?e.isInSet(a.marks)&&(f=[e]):f=a.marks;if(f&&f.length)for(var p=Math.min(s+a.nodeSize,t),h=0;h<f.length;h++){for(var c=f[h],d=void 0,v=0;v<i.length;v++){var y=i[v];y.step==o-1&&c.eq(i[v].style)&&(d=y)}d?(d.to=p,d.step=o):i.push({style:c,from:Math.max(s,n),to:p,step:o})}}}),i.forEach(function(a){return r.step(new kt(a.from,a.to,a.style))}),this},E.prototype.clearIncompatible=function(n,t,e){void 0===e&&(e=t.contentMatch);for(var r=this.doc.nodeAt(n),i=[],o=n+1,a=0;a<r.childCount;a++){var s=r.child(a),f=o+s.nodeSize,l=e.matchType(s.type,s.attrs);if(l){e=l;for(var u=0;u<s.marks.length;u++)t.allowsMarkType(s.marks[u].type)||this.step(new kt(o,f,s.marks[u]))}else i.push(new tt(o,f,g.empty));o=f}if(!e.validEnd){var p=e.fillBefore(m.empty,!0);this.replace(o,o,new g(p,0,0))}for(var h=i.length-1;h>=0;h--)this.step(i[h]);return this},E.prototype.replace=function(n,t,e){void 0===t&&(t=n),void 0===e&&(e=g.empty);var r=function ti(n,t,e,r){if(void 0===e&&(e=t),void 0===r&&(r=g.empty),t==e&&!r.size)return null;var i=n.resolve(t),o=n.resolve(e);return gr(i,o,r)?new tt(t,e,r):new U(i,o,r).fit()}(this.doc,n,t,e);return r&&this.step(r),this},E.prototype.replaceWith=function(n,t,e){return this.replace(n,t,new g(m.from(e),0,0))},E.prototype.delete=function(n,t){return this.replace(n,t,g.empty)},E.prototype.insert=function(n,t){return this.replaceWith(n,n,t)};var U=function(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var i=0;i<=t.depth;i++){var o=t.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(i))})}this.placed=m.empty;for(var a=t.depth;a>0;a--)this.placed=m.from(t.node(a).copy(this.placed))},wr={depth:{configurable:!0}};function xt(n,t,e){return 0==t?n.cutByIndex(e):n.replaceChild(0,n.firstChild.copy(xt(n.firstChild.content,t-1,e)))}function Mt(n,t,e){return 0==t?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(Mt(n.lastChild.content,t-1,e)))}function Se(n,t){for(var e=0;e<t;e++)n=n.firstChild.content;return n}function Sr(n,t,e){if(t<=0)return n;var r=n.content;return t>1&&(r=r.replaceChild(0,Sr(r.firstChild,t-1,1==r.childCount?e-1:0))),t>0&&(r=n.type.contentMatch.fillBefore(r).append(r),e<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(m.empty,!0)))),n.copy(r)}function be(n,t,e,r,i){var o=n.node(t),a=i?n.indexAfter(t):n.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;var s=r.fillBefore(o.content,!0,a);return s&&!function ei(n,t,e){for(var r=e;r<t.childCount;r++)if(!n.allowsMarks(t.child(r).marks))return!0;return!1}(e,o.content,a)?s:null}function br(n,t,e,r,i){if(t<e){var o=n.firstChild;n=n.replaceChild(0,o.copy(br(o.content,t+1,e,r,o)))}if(t>r){var a=i.contentMatchAt(0),s=a.fillBefore(n).append(n);n=s.append(a.matchFragment(s).fillBefore(m.empty,!0))}return n}function Cr(n,t){for(var e=[],i=Math.min(n.depth,t.depth);i>=0;i--){var o=n.start(i);if(o<n.pos-(n.depth-i)||t.end(i)>t.pos+(t.depth-i)||n.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(o==t.start(i)||i==n.depth&&i==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==o-1)&&e.push(i)}return e}wr.depth.get=function(){return this.frontier.length-1},U.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,i=this.$from,o=this.close(e<0?this.$to:i.doc.resolve(e));if(!o)return null;for(var a=this.placed,s=i.depth,f=o.depth;s&&f&&1==a.childCount;)a=a.firstChild.content,s--,f--;var l=new g(a,s,f);return e>-1?new at(i.pos,e,this.$to.pos,this.$to.end(),l,r):l.size||i.pos!=this.$to.pos?new tt(i.pos,o.pos,l):void 0},U.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--)for(var i=void 0,o=(e?(i=Se(this.unplaced.content,e-1).firstChild).content:this.unplaced.content).firstChild,a=this.depth;a>=0;a--){var s=this.frontier[a],f=s.type,l=s.match,u=void 0,p=void 0;if(1==t&&(o?l.matchType(o.type)||(p=l.fillBefore(m.from(o),!1)):f.compatibleContent(i.type)))return{sliceDepth:e,frontierDepth:a,parent:i,inject:p};if(2==t&&o&&(u=l.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:a,parent:i,wrap:u};if(i&&l.matchType(i.type))break}},U.prototype.openMore=function(){var t=this.unplaced,e=t.content,r=t.openStart,i=t.openEnd,o=Se(e,r);return!(!o.childCount||o.firstChild.isLeaf||(this.unplaced=new g(e,r+1,Math.max(i,o.size+r>=e.size-i?r+1:0)),0))},U.prototype.dropNode=function(){var t=this.unplaced,e=t.content,r=t.openStart,i=t.openEnd,o=Se(e,r);if(o.childCount<=1&&r>0){var a=e.size-r<=r+o.size;this.unplaced=new g(xt(e,r-1,1),r-1,a?r-1:i)}else this.unplaced=new g(xt(e,r,1),r,i)},U.prototype.placeNodes=function(t){for(var e=t.sliceDepth,r=t.frontierDepth,i=t.parent,o=t.inject,a=t.wrap;this.depth>r;)this.closeFrontierNode();if(a)for(var s=0;s<a.length;s++)this.openFrontierNode(a[s]);var f=this.unplaced,l=i?i.content:f.content,u=f.openStart-e,p=0,h=[],c=this.frontier[r],d=c.match,v=c.type;if(o){for(var y=0;y<o.childCount;y++)h.push(o.child(y));d=d.matchFragment(o)}for(var C=l.size+e-(f.content.size-f.openEnd);p<l.childCount;){var w=l.child(p),z=d.matchType(w.type);if(!z)break;(++p>1||0==u||w.content.size)&&(d=z,h.push(Sr(w.mark(v.allowedMarks(w.marks)),1==p?u:0,p==l.childCount?C:-1)))}var x=p==l.childCount;x||(C=-1),this.placed=Mt(this.placed,r,m.from(h)),this.frontier[r].match=d,x&&C<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var A=0,P=l;A<C;A++){var J=P.lastChild;this.frontier.push({type:J.type,match:J.contentMatchAt(J.childCount)}),P=J.content}this.unplaced=x?0==e?g.empty:new g(xt(f.content,e-1,1),e-1,C<0?f.openEnd:e-1):new g(xt(f.content,e,p),f.openStart,f.openEnd)},U.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var e,t=this.frontier[this.depth];if(!t.type.isTextblock||!be(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var i=this.$to.depth,o=this.$to.after(i);i>1&&o==this.$to.end(--i);)++o;return o},U.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],i=r.match,o=r.type,a=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=be(t,e,o,i,a);if(s){for(var f=e-1;f>=0;f--){var l=this.frontier[f],h=be(t,f,l.type,l.match,!0);if(!h||h.childCount)continue t}return{depth:e,fit:s,move:a?t.doc.resolve(t.after(e+1)):t}}}},U.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Mt(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var i=t.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,t.index(r));this.openFrontierNode(i.type,i.attrs,o)}return t},U.prototype.openFrontierNode=function(t,e,r){var i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=Mt(this.placed,this.depth,m.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})},U.prototype.closeFrontierNode=function(){var e=this.frontier.pop().match.fillBefore(m.empty,!0);e.childCount&&(this.placed=Mt(this.placed,this.frontier.length,e))},Object.defineProperties(U.prototype,wr),E.prototype.replaceRange=function(n,t,e){if(!e.size)return this.deleteRange(n,t);var r=this.doc.resolve(n),i=this.doc.resolve(t);if(gr(r,i,e))return this.step(new tt(n,t,e));var o=Cr(r,this.doc.resolve(t));0==o[o.length-1]&&o.pop();var a=-(r.depth+1);o.unshift(a);for(var s=r.depth,f=r.pos-1;s>0;s--,f--){var l=r.node(s).type.spec;if(l.defining||l.isolating)break;o.indexOf(s)>-1?a=s:r.before(s)==f&&o.splice(1,0,-s)}for(var u=o.indexOf(a),p=[],h=e.openStart,c=e.content,d=0;;d++){var v=c.firstChild;if(p.push(v),d==e.openStart)break;c=v.content}h>0&&p[h-1].type.spec.defining&&r.node(u).type!=p[h-1].type?h-=1:h>=2&&p[h-1].isTextblock&&p[h-2].type.spec.defining&&r.node(u).type!=p[h-2].type&&(h-=2);for(var y=e.openStart;y>=0;y--){var C=(y+h+1)%(e.openStart+1),w=p[C];if(w)for(var z=0;z<o.length;z++){var x=o[(z+u)%o.length],A=!0;x<0&&(A=!1,x=-x);var P=r.node(x-1),J=r.index(x-1);if(P.canReplaceWith(J,J,w.type,w.marks))return this.replace(r.before(x),A?i.after(x):t,new g(br(e.content,0,e.openStart,C),C,e.openEnd))}}for(var Rt=this.steps.length,st=o.length-1;st>=0&&(this.replace(n,t,e),!(this.steps.length>Rt));st--){var mt=o[st];mt<0||(n=r.before(mt),t=i.after(mt))}return this},E.prototype.replaceRangeWith=function(n,t,e){if(!e.isInline&&n==t&&this.doc.resolve(n).parent.content.size){var r=function $n(n,t,e){var r=n.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),e))return t;if(0==r.parentOffset)for(var i=r.depth-1;i>=0;i--){var o=r.index(i);if(r.node(i).canReplaceWith(o,o,e))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(var a=r.depth-1;a>=0;a--){var s=r.indexAfter(a);if(r.node(a).canReplaceWith(s,s,e))return r.after(a+1);if(s<r.node(a).childCount)return null}}(this.doc,n,e.type);null!=r&&(n=t=r)}return this.replaceRange(n,t,new g(m.from(e),0,0))},E.prototype.deleteRange=function(n,t){for(var e=this.doc.resolve(n),r=this.doc.resolve(t),i=Cr(e,r),o=0;o<i.length;o++){var a=i[o],s=o==i.length-1;if(s&&0==a||e.node(a).type.contentMatch.validEnd)return this.delete(e.start(a),r.end(a));if(a>0&&(s||e.node(a-1).canReplace(e.index(a-1),r.indexAfter(a-1))))return this.delete(e.before(a),r.after(a))}for(var f=1;f<=e.depth&&f<=r.depth;f++)if(n-e.start(f)==e.depth-f&&t>e.end(f)&&r.end(f)-t!=r.depth-f)return this.delete(e.before(f),t);return this.delete(n,t)};var Ce=Object.create(null),O=function(t,e,r){this.ranges=r||[new ri(t.min(e),t.max(e))],this.$anchor=t,this.$head=e},et={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};et.anchor.get=function(){return this.$anchor.pos},et.head.get=function(){return this.$head.pos},et.from.get=function(){return this.$from.pos},et.to.get=function(){return this.$to.pos},et.$from.get=function(){return this.ranges[0].$from},et.$to.get=function(){return this.ranges[0].$to},et.empty.get=function(){for(var n=this.ranges,t=0;t<n.length;t++)if(n[t].$from.pos!=n[t].$to.pos)return!1;return!0},O.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)},O.prototype.replace=function(t,e){void 0===e&&(e=g.empty);for(var r=e.content.lastChild,i=null,o=0;o<e.openEnd;o++)i=r,r=r.lastChild;for(var a=t.steps.length,s=this.ranges,f=0;f<s.length;f++){var l=s[f],u=l.$from,p=l.$to,h=t.mapping.slice(a);t.replaceRange(h.map(u.pos),h.map(p.pos),f?g.empty:e),0==f&&kr(t,a,(r?r.isInline:i&&i.isTextblock)?-1:1)}},O.prototype.replaceWith=function(t,e){for(var r=t.steps.length,i=this.ranges,o=0;o<i.length;o++){var a=i[o],s=a.$from,f=a.$to,l=t.mapping.slice(r),u=l.map(s.pos),p=l.map(f.pos);o?t.deleteRange(u,p):(t.replaceRangeWith(u,p,e),kr(t,r,e.isInline?-1:1))}},O.findFrom=function(t,e,r){var i=t.parent.inlineContent?new ct(t):vt(t.node(0),t.parent,t.pos,t.index(),e,r);if(i)return i;for(var o=t.depth-1;o>=0;o--){var a=e<0?vt(t.node(0),t.node(o),t.before(o+1),t.index(o),e,r):vt(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,r);if(a)return a}},O.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Nt(t.node(0))},O.atStart=function(t){return vt(t,t,0,0,1)||new Nt(t)},O.atEnd=function(t){return vt(t,t,t.content.size,t.childCount,-1)||new Nt(t)},O.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var r=Ce[e.type];if(!r)throw new RangeError("No selection type "+e.type+" defined");return r.fromJSON(t,e)},O.jsonID=function(t,e){if(t in Ce)throw new RangeError("Duplicate use of selection JSON ID "+t);return Ce[t]=e,e.prototype.jsonID=t,e},O.prototype.getBookmark=function(){return ct.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(O.prototype,et),O.prototype.visible=!0;var ri=function(t,e){this.$from=t,this.$to=e},ct=function(n){function t(r,i){void 0===i&&(i=r),n.call(this,r,i)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={$cursor:{configurable:!0}};return e.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},t.prototype.map=function(i,o){var a=i.resolve(o.map(this.head));if(!a.parent.inlineContent)return n.near(a);var s=i.resolve(o.map(this.anchor));return new t(s.parent.inlineContent?s:a,a)},t.prototype.replace=function(i,o){if(void 0===o&&(o=g.empty),n.prototype.replace.call(this,i,o),o==g.empty){var a=this.$from.marksAcross(this.$to);a&&i.ensureMarks(a)}},t.prototype.eq=function(i){return i instanceof t&&i.anchor==this.anchor&&i.head==this.head},t.prototype.getBookmark=function(){return new Tt(this.anchor,this.head)},t.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},t.fromJSON=function(i,o){if("number"!=typeof o.anchor||"number"!=typeof o.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new t(i.resolve(o.anchor),i.resolve(o.head))},t.create=function(i,o,a){void 0===a&&(a=o);var s=i.resolve(o);return new this(s,a==o?s:i.resolve(a))},t.between=function(i,o,a){var s=i.pos-o.pos;if((!a||s)&&(a=s>=0?1:-1),!o.parent.inlineContent){var f=n.findFrom(o,a,!0)||n.findFrom(o,-a,!0);if(!f)return n.near(o,a);o=f.$head}return i.parent.inlineContent||(0==s||(i=(n.findFrom(i,-a,!0)||n.findFrom(i,a,!0)).$anchor).pos<o.pos!=s<0)&&(i=o),new t(i,o)},Object.defineProperties(t.prototype,e),t}(O);O.jsonID("text",ct);var Tt=function(t,e){this.anchor=t,this.head=e};Tt.prototype.map=function(t){return new Tt(t.map(this.anchor),t.map(this.head))},Tt.prototype.resolve=function(t){return ct.between(t.resolve(this.anchor),t.resolve(this.head))};var dt=function(n){function t(e){var r=e.nodeAfter,i=e.node(0).resolve(e.pos+r.nodeSize);n.call(this,e,i),this.node=r}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.map=function(r,i){var o=i.mapResult(this.anchor),a=o.deleted,f=r.resolve(o.pos);return a?n.near(f):new t(f)},t.prototype.content=function(){return new g(m.from(this.node),0,0)},t.prototype.eq=function(r){return r instanceof t&&r.anchor==this.anchor},t.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},t.prototype.getBookmark=function(){return new Kt(this.anchor)},t.fromJSON=function(r,i){if("number"!=typeof i.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new t(r.resolve(i.anchor))},t.create=function(r,i){return new this(r.resolve(i))},t.isSelectable=function(r){return!r.isText&&!1!==r.type.spec.selectable},t}(O);dt.prototype.visible=!1,O.jsonID("node",dt);var Kt=function(t){this.anchor=t};Kt.prototype.map=function(t){var e=t.mapResult(this.anchor),i=e.pos;return e.deleted?new Tt(i,i):new Kt(i)},Kt.prototype.resolve=function(t){var e=t.resolve(this.anchor),r=e.nodeAfter;return r&&dt.isSelectable(r)?new dt(e):O.near(e)};var Nt=function(n){function t(e){n.call(this,e.resolve(0),e.resolve(e.content.size))}return n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t,t.prototype.replace=function(r,i){if(void 0===i&&(i=g.empty),i==g.empty){r.delete(0,r.doc.content.size);var o=n.atStart(r.doc);o.eq(r.selection)||r.setSelection(o)}else n.prototype.replace.call(this,r,i)},t.prototype.toJSON=function(){return{type:"all"}},t.fromJSON=function(r){return new t(r)},t.prototype.map=function(r){return new t(r)},t.prototype.eq=function(r){return r instanceof t},t.prototype.getBookmark=function(){return ni},t}(O);O.jsonID("all",Nt);var ni={map:function(){return this},resolve:function(t){return new Nt(t)}};function vt(n,t,e,r,i,o){if(t.inlineContent)return ct.create(n,e);for(var a=r-(i>0?0:1);i>0?a<t.childCount:a>=0;a+=i){var s=t.child(a);if(s.isAtom){if(!o&&dt.isSelectable(s))return dt.create(n,e-(i<0?s.nodeSize:0))}else{var f=vt(n,s,e+i,i<0?s.childCount:0,i,o);if(f)return f}e+=s.nodeSize*i}}function kr(n,t,e){var r=n.steps.length-1;if(!(r<t)){var a,i=n.steps[r];(i instanceof tt||i instanceof at)&&(n.mapping.maps[r].forEach(function(s,f,l,u){null==a&&(a=u)}),n.setSelection(O.near(n.doc.resolve(a),e)))}}var ii=function(n){function t(r){n.call(this,r.doc),this.time=Date.now(),this.curSelection=r.selection,this.curSelectionFor=0,this.storedMarks=r.storedMarks,this.updated=0,this.meta=Object.create(null)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return e.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},t.prototype.setSelection=function(i){if(i.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=i,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},e.selectionSet.get=function(){return(1&this.updated)>0},t.prototype.setStoredMarks=function(i){return this.storedMarks=i,this.updated|=2,this},t.prototype.ensureMarks=function(i){return S.sameSet(this.storedMarks||this.selection.$from.marks(),i)||this.setStoredMarks(i),this},t.prototype.addStoredMark=function(i){return this.ensureMarks(i.addToSet(this.storedMarks||this.selection.$head.marks()))},t.prototype.removeStoredMark=function(i){return this.ensureMarks(i.removeFromSet(this.storedMarks||this.selection.$head.marks()))},e.storedMarksSet.get=function(){return(2&this.updated)>0},t.prototype.addStep=function(i,o){n.prototype.addStep.call(this,i,o),this.updated=-3&this.updated,this.storedMarks=null},t.prototype.setTime=function(i){return this.time=i,this},t.prototype.replaceSelection=function(i){return this.selection.replace(this,i),this},t.prototype.replaceSelectionWith=function(i,o){var a=this.selection;return!1!==o&&(i=i.mark(this.storedMarks||(a.empty?a.$from.marks():a.$from.marksAcross(a.$to)||S.none))),a.replaceWith(this,i),this},t.prototype.deleteSelection=function(){return this.selection.replace(this),this},t.prototype.insertText=function(i,o,a){void 0===a&&(a=o);var s=this.doc.type.schema;if(null==o)return i?this.replaceSelectionWith(s.text(i),!0):this.deleteSelection();if(!i)return this.deleteRange(o,a);var f=this.storedMarks;if(!f){var l=this.doc.resolve(o);f=a==o?l.marks():l.marksAcross(this.doc.resolve(a))}return this.replaceRangeWith(o,a,s.text(i,f)),this.selection.empty||this.setSelection(O.near(this.selection.$to)),this},t.prototype.setMeta=function(i,o){return this.meta["string"==typeof i?i:i.key]=o,this},t.prototype.getMeta=function(i){return this.meta["string"==typeof i?i:i.key]},e.isGeneric.get=function(){for(var r in this.meta)return!1;return!0},t.prototype.scrollIntoView=function(){return this.updated|=4,this},e.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(t.prototype,e),t}(E);function Tr(n,t){return t&&n?n.bind(t):n}var Ot=function(t,e,r){this.name=t,this.init=Tr(e.init,r),this.apply=Tr(e.apply,r)},oi=[new Ot("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new Ot("selection",{init:function(t,e){return t.selection||O.atStart(e.doc)},apply:function(t){return t.selection}}),new Ot("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,r,i){return i.selection.$cursor?t.storedMarks:null}}),new Ot("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],ke=function(t,e){var r=this;this.schema=t,this.fields=oi.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),e&&e.forEach(function(i){if(r.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");r.plugins.push(i),r.pluginsByKey[i.key]=i,i.spec.state&&r.fields.push(new Ot(i.key,i.spec.state,i))})},q=function(t){this.config=t},Xt={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};Xt.schema.get=function(){return this.config.schema},Xt.plugins.get=function(){return this.config.plugins},q.prototype.apply=function(t){return this.applyTransaction(t).state},q.prototype.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var r=0;r<this.config.plugins.length;r++)if(r!=e){var i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,t,this))return!1}return!0},q.prototype.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],r=this.applyInner(t),i=null;;){for(var o=!1,a=0;a<this.config.plugins.length;a++){var s=this.config.plugins[a];if(s.spec.appendTransaction){var f=i?i[a].n:0,l=i?i[a].state:this,u=f<e.length&&s.spec.appendTransaction.call(s,f?e.slice(f):e,l,r);if(u&&r.filterTransaction(u,a)){if(u.setMeta("appendedTransaction",t),!i){i=[];for(var p=0;p<this.config.plugins.length;p++)i.push(p<a?{state:r,n:e.length}:{state:this,n:0})}e.push(u),r=r.applyInner(u),o=!0}i&&(i[a]={state:r,n:e.length})}}if(!o)return{state:r,transactions:e}}},q.prototype.applyInner=function(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var e=new q(this.config),r=this.config.fields,i=0;i<r.length;i++){var o=r[i];e[o.name]=o.apply(t,this[o.name],this,e)}for(var a=0;a<At.length;a++)At[a](this,t,e);return e},Xt.tr.get=function(){return new ii(this)},q.create=function(t){for(var e=new ke(t.doc?t.doc.type.schema:t.schema,t.plugins),r=new q(e),i=0;i<e.fields.length;i++)r[e.fields[i].name]=e.fields[i].init(t,r);return r},q.prototype.reconfigure=function(t){for(var e=new ke(this.schema,t.plugins),r=e.fields,i=new q(e),o=0;o<r.length;o++){var a=r[o].name;i[a]=this.hasOwnProperty(a)?this[a]:r[o].init(t,i)}return i},q.prototype.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(a){return a.toJSON()})),t&&"object"==typeof t)for(var r in t){if("doc"==r||"selection"==r)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var i=t[r],o=i.spec.state;o&&o.toJSON&&(e[r]=o.toJSON.call(i,this[i.key]))}return e},q.fromJSON=function(t,e,r){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");var i=new ke(t.schema,t.plugins),o=new q(i);return i.fields.forEach(function(a){if("doc"==a.name)o.doc=b.fromJSON(t.schema,e.doc);else if("selection"==a.name)o.selection=O.fromJSON(o.doc,e.selection);else if("storedMarks"==a.name)e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(r)for(var s in r){var f=r[s],l=f.spec.state;if(f.key==a.name&&l&&l.fromJSON&&Object.prototype.hasOwnProperty.call(e,s))return void(o[a.name]=l.fromJSON.call(f,t,e[s],o))}o[a.name]=a.init(t,o)}}),o},q.addApplyListener=function(t){At.push(t)},q.removeApplyListener=function(t){var e=At.indexOf(t);e>-1&&At.splice(e,1)},Object.defineProperties(q.prototype,Xt);var At=[];function Nr(n,t){return t?n.createChecked(null,t):n.createAndFill()}function Or(n,t,e,r,i){const o=function ai(n){if(n.cached.tableNodeTypes)return n.cached.tableNodeTypes;const t={};return Object.keys(n.nodes).forEach(e=>{const r=n.nodes[e];r.spec.tableRole&&(t[r.spec.tableRole]=r)}),n.cached.tableNodeTypes=t,t}(n),a=[],s=[];for(let l=0;l<e;l+=1){const u=Nr(o.cell,i);if(u&&s.push(u),r){const p=Nr(o.header_cell,i);p&&a.push(p)}}const f=[];for(let l=0;l<t;l+=1)f.push(o.row.createChecked(null,r&&0===l?a:s));return o.table.createChecked(null,f)}const Gt=({editor:n})=>{const{selection:t}=n.state;if(!function si(n){return n instanceof M}(t))return!1;let e=0;const r=(0,yt.findParentNodeClosestToPos)(t.ranges[0].$from,o=>"table"===o.type.name);return null==r||r.node.descendants(o=>{if("table"===o.type.name)return!1;["tableCell","tableHeader"].includes(o.type.name)&&(e+=1)}),e===t.ranges.length&&(n.commands.deleteTable(),!0)};function Ar(n,t,e,r,i,o){let a=0,s=!0,f=t.firstChild;const l=n.firstChild;for(let u=0,p=0;u<l.childCount;u+=1){const{colspan:h,colwidth:c}=l.child(u).attrs;for(let d=0;d<h;d+=1,p+=1){const v=i===p?o:c&&c[d],y=v?`${v}px`:"";a+=v||r,v||(s=!1),f?(f.style.width!==y&&(f.style.width=y),f=f.nextSibling):t.appendChild(document.createElement("col")).style.width=y}}for(;f;){const u=f.nextSibling;f.parentNode.removeChild(f),f=u}s?(e.style.width=`${a}px`,e.style.minWidth=""):(e.style.width="",e.style.minWidth=`${a}px`)}class fi{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Ar(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type===this.node.type&&(this.node=t,Ar(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"===t.type&&(t.target===this.table||this.colgroup.contains(t.target))}}const Rr=yt.Node.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:fi,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({HTMLAttributes:n}){return["table",(0,yt.mergeAttributes)(this.options.HTMLAttributes,n),["tbody",0]]},addCommands:()=>({insertTable:({rows:n=3,cols:t=3,withHeaderRow:e=!0}={})=>({tr:r,dispatch:i,editor:o})=>{const a=Or(o.schema,n,t,e);if(i){const s=r.selection.anchor+1;r.replaceSelectionWith(a).scrollIntoView().setSelection(ct.near(r.doc.resolve(s)))}return!0},addColumnBefore:()=>({state:n,dispatch:t})=>function rn(n,t){if(!X(n))return!1;if(t){var e=G(n);t(De(n.tr,e,e.left))}return!0}(n,t),addColumnAfter:()=>({state:n,dispatch:t})=>function nn(n,t){if(!X(n))return!1;if(t){var e=G(n);t(De(n.tr,e,e.right))}return!0}(n,t),deleteColumn:()=>({state:n,dispatch:t})=>function an(n,t){if(!X(n))return!1;if(t){var e=G(n),r=n.tr;if(0==e.left&&e.right==e.map.width)return!1;for(var i=e.right-1;on(r,e,i),i!=e.left;i--)e.table=e.tableStart?r.doc.nodeAt(e.tableStart-1):r.doc,e.map=k.get(e.table);t(r)}return!0}(n,t),addRowBefore:()=>({state:n,dispatch:t})=>function fn(n,t){if(!X(n))return!1;if(t){var e=G(n);t(Pe(n.tr,e,e.top))}return!0}(n,t),addRowAfter:()=>({state:n,dispatch:t})=>function ln(n,t){if(!X(n))return!1;if(t){var e=G(n);t(Pe(n.tr,e,e.bottom))}return!0}(n,t),deleteRow:()=>({state:n,dispatch:t})=>function pn(n,t){if(!X(n))return!1;if(t){var e=G(n),r=n.tr;if(0==e.top&&e.bottom==e.map.height)return!1;for(var i=e.bottom-1;un(r,e,i),i!=e.top;i--)e.table=e.tableStart?r.doc.nodeAt(e.tableStart-1):r.doc,e.map=k.get(e.table);t(r)}return!0}(n,t),deleteTable:()=>({state:n,dispatch:t})=>function Sn(n,t){for(var e=n.selection.$anchor,r=e.depth;r>0;r--)if("table"==e.node(r).type.spec.tableRole)return t&&t(n.tr.delete(e.before(r),e.after(r)).scrollIntoView()),!0;return!1}(n,t),mergeCells:()=>({state:n,dispatch:t})=>Le(n,t),splitCell:()=>({state:n,dispatch:t})=>He(n,t),toggleHeaderColumn:()=>({state:n,dispatch:t})=>yn(n,t),toggleHeaderRow:()=>({state:n,dispatch:t})=>mn(n,t),toggleHeaderCell:()=>({state:n,dispatch:t})=>gn(n,t),mergeOrSplit:()=>({state:n,dispatch:t})=>!!Le(n,t)||He(n,t),setCellAttribute:(n,t)=>({state:e,dispatch:r})=>function dn(n,t){return function(e,r){if(!X(e))return!1;var i=It(e);if(i.nodeAfter.attrs[n]===t)return!1;if(r){var o=e.tr;e.selection instanceof M?e.selection.forEachCell(function(a,s){a.attrs[n]!==t&&o.setNodeMarkup(s,null,F(a.attrs,n,t))}):o.setNodeMarkup(i.pos,null,F(i.nodeAfter.attrs,n,t)),r(o)}return!0}}(n,t)(e,r),goToNextCell:()=>({state:n,dispatch:t})=>Ve(1)(n,t),goToPreviousCell:()=>({state:n,dispatch:t})=>Ve(-1)(n,t),fixTables:()=>({state:n,dispatch:t})=>(t&&_e(n),!0),setCellSelection:n=>({tr:t,dispatch:e})=>{if(e){const r=M.create(t.doc,n.anchorCell,n.headCell);t.setSelection(r)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Gt,"Mod-Backspace":Gt,Delete:Gt,"Mod-Delete":Gt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[bn({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],En({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema:n=>({tableRole:(0,yt.callOrReturn)((0,yt.getExtensionField)(n,"tableRole",{name:n.name,options:n.options,storage:n.storage}))})})}}]);